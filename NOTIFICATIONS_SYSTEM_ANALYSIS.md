# üìä –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Prisma Schema)

**–¢–∞–±–ª–∏—Ü–∞ `notifications`**:
```sql
model Notification {
  id          String   @id @default(cuid())
  user_id     String   // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  client_id   String?  // ID –∫–ª–∏–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  document_id String?  // ID –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  type        String   // –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (invoice_paid, status_changed, etc.)
  title       String   // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  message     String   // –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  is_read     Boolean  @default(false)
  created_at  DateTime @default(now())
  
  // –°–≤—è–∑–∏
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  client      Client?  @relation(fields: [client_id], references: [id], onDelete: Cascade)
}
```

**–ò–Ω–¥–µ–∫—Å—ã**:
- `user_id` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `is_read` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `created_at` - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. `lib/notifications.ts` - –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**–§—É–Ω–∫—Ü–∏–∏**:
- `createNotification(data)` - —Å–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –ë–î
- `notifyUsersByRole(role, data)` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —Ä–æ–ª—å—é
- `notifyUser(userId, data)` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–õ–æ–≥–∏–∫–∞**:
```typescript
// 1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é
const users = await prisma.user.findMany({
  where: { 
    role: role.toUpperCase(),  // –í–∞–∂–Ω–æ! UPPERCASE
    is_active: true
  }
});

// 2. –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
const notifications = await Promise.all(
  users.map(user => createNotification({...data, userId: user.id}))
);
```

### 2. `lib/notifications/status-notifications.ts` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–∞—Ö

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```typescript
export const STATUS_NOTIFICATIONS = {
  quote: {
    'SENT': {
      recipients: ['complectator'],  // –ö—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç
      message: '–ö–ü –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'       // –ß—Ç–æ –ø–æ–ª—É—á–∞—é—Ç
    },
    'ACCEPTED': {
      recipients: ['complectator'],
      message: '–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω—è–ª –ö–ü'
    }
  },
  invoice: {
    'PAID': {
      recipients: ['executor'],
      message: '–°—á–µ—Ç –æ–ø–ª–∞—á–µ–Ω'
    },
    'ORDERED': {
      recipients: ['complectator'],
      message: '–ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω'
    }
  }
  // ... –∏ —Ç.–¥.
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ–π—á–∞—Å –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–¥–µ.

### 3. `lib/notifications/notification-service.ts` - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Å–µ—Ä–≤–∏—Å

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–µ—Ä–≤–∏—Å —Å —à–∞–±–ª–æ–Ω–∞–º–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏, –∫–∞–Ω–∞–ª–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- Singleton –ø–∞—Ç—Ç–µ—Ä–Ω
- –®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (LOW, MEDIUM, HIGH, URGENT)
- –ö–∞–Ω–∞–ª—ã –¥–æ—Å—Ç–∞–≤–∫–∏ (IN_APP, EMAIL, SMS)
- –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ. –û–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –∑–∞–≥–ª—É—à–∫–∞.

### 4. API Endpoints

**GET `/api/notifications`** - –ø–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT (Authorization header –∏–ª–∏ Cookie)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ 50 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –í–∫–ª—é—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞

**POST `/api/notifications`** - —Å–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)

---

## üìç –ì–¥–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 1. Invoice Status (`app/api/invoices/[id]/status/route.ts`)

**–°–æ–±—ã—Ç–∏—è**:
- **PAID** ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º EXECUTOR
- **ORDERED, RECEIVED_FROM_SUPPLIER, COMPLETED** ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º COMPLECTATOR

**–ö–æ–¥**:
```typescript
if (status === 'PAID') {
  await notifyUsersByRole('EXECUTOR', {
    clientId: existingInvoice.client_id,
    documentId: id,
    type: 'invoice_paid',
    title: '–°—á–µ—Ç –æ–ø–ª–∞—á–µ–Ω',
    message: `–°—á–µ—Ç ${existingInvoice.number} –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –≤ —Å—Ç–∞—Ç—É—Å "–û–ø–ª–∞—á–µ–Ω/–ó–∞–∫–∞–∑".`
  });
} else if (['ORDERED', 'RECEIVED_FROM_SUPPLIER', 'COMPLETED'].includes(status)) {
  await notifyUsersByRole('COMPLECTATOR', {
    clientId: existingInvoice.client_id,
    documentId: id,
    type: 'status_changed',
    title: '–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω',
    message: `–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞ ${existingInvoice.number}...`
  });
}
```

### 2. Quote Status (`app/api/quotes/[id]/status/route.ts`)

**–°–æ–±—ã—Ç–∏—è**:
- **SENT** ‚Üí –ù–∏—á–µ–≥–æ (–∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –∑–∞—Ö–æ–¥—è—Ç –≤ —Å–∏—Å—Ç–µ–º—É)
- **ACCEPTED** ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º COMPLECTATOR

**–ö–æ–¥**:
```typescript
if (status === 'SENT') {
  console.log('üìß –ö–ü –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É:', quoteWithClient.number);
} else if (status === 'ACCEPTED') {
  await notifyUsersByRole('COMPLECTATOR', {
    clientId: quoteWithClient.client_id,
    documentId: id,
    type: 'quote_accepted',
    title: '–ö–ü –ø—Ä–∏–Ω—è—Ç–æ',
    message: `–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω—è–ª –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ${quoteWithClient.number}.`
  });
}
```

### 3. Supplier Order Status (`app/api/supplier-orders/[id]/status/route.ts`)

**–°–æ–±—ã—Ç–∏—è**:
- **ORDERED, RECEIVED_FROM_SUPPLIER, COMPLETED** ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º COMPLECTATOR

**–ö–æ–¥**:
```typescript
await notifyUsersByRole('COMPLECTATOR', {
  clientId: invoice.client_id,
  documentId: invoice.id,
  type: 'status_changed',
  title: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞',
  message: invoiceInfo
});
```

### 4. Universal Document Status (`app/api/documents/[id]/status/route.ts`)

**–°–æ–±—ã—Ç–∏—è**: –í—ã–∑—ã–≤–∞–µ—Ç `sendStatusNotification` (–∏–∑ `status-notifications.ts`)

**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `notifyUsersByRole` –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –î–≤–æ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å—Ç—å –î–í–ï —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
1. **–ü—Ä–æ—Å—Ç–∞—è** (`lib/notifications.ts`) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚úÖ
2. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è** (`lib/notifications/notification-service.ts`) - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚ùå

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 50% –∫–æ–¥–∞ –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥ (dead code)

### 2. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ `status-notifications.ts`

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –í `status-notifications.ts` –µ—Å—Ç—å –∫—Ä–∞—Å–∏–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
- –ù–æ –æ–Ω–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ
- –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º API —Ä–æ—É—Ç–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### 3. –°—Ç–∞—Ç—É—Å—ã Invoice –º–µ–Ω—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –í Invoice API –µ—Å—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è `ORDERED`, `RECEIVED_FROM_SUPPLIER`, `COMPLETED`
- –ù–û —ç—Ç–∏ —Å—Ç–∞—Ç—É—Å—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –º–µ–Ω—è—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é!
- –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –º–µ–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ SupplierOrder

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –¥–≤–∞–∂–¥—ã (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏, –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º)

### 4. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- `notifyUsersByRole` —Å–æ–∑–¥–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é
- –ù–æ –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —ç—Ç–æ–π —Ä–æ–ª—å—é - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- –û—à–∏–±–∫–∞ –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–æ–≥—É—Ç "—Ç–µ—Ä—è—Ç—å—Å—è" –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### 5. –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ –ë–î
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ —Å–æ–∑–¥–∞–ª–æ—Å—å - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É

---

## üìä –¢–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```
Invoice PAID (–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–µ–Ω—è–µ—Ç)
  ‚Üì
  —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º EXECUTOR
    ‚Üì
    –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç SupplierOrder
      ‚Üì
      SupplierOrder ORDERED
        ‚Üì
        —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º COMPLECTATOR
        —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Invoice ‚Üí ORDERED
      ‚Üì
      SupplierOrder RECEIVED_FROM_SUPPLIER
        ‚Üì
        —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º COMPLECTATOR
        —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Invoice ‚Üí RECEIVED_FROM_SUPPLIER
      ‚Üì
      SupplierOrder COMPLETED
        ‚Üì
        —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º COMPLECTATOR
        —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Invoice ‚Üí COMPLETED
```

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
3. ‚úÖ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
4. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
5. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–æ–ª—è–º

---

## üîç –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥

- `lib/notifications/notification-service.ts` - –ø–æ–ª–Ω–æ—Å—Ç—å—é
- `lib/notifications/quote-notifications.ts` - –ø–æ–ª–Ω–æ—Å—Ç—å—é
- `lib/notifications/types.ts` - –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- `lib/notificationUtils.ts` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `status-notifications.ts`

**–í–º–µ—Å—Ç–æ**:
```typescript
if (status === 'PAID') {
  await notifyUsersByRole('EXECUTOR', {...});
}
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```typescript
await sendStatusNotification(
  documentId, 'invoice', documentNumber, 
  oldStatus, newStatus, clientId
);
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
export async function notifyUsersByRole(role: string, data: Omit<NotificationData, 'userId'>) {
  const users = await prisma.user.findMany({
    where: { role: role.toUpperCase(), is_active: true }
  });
  
  console.log(`üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ ${role}: –Ω–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
  
  if (users.length === 0) {
    console.warn(`‚ö†Ô∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é ${role}`);
    return [];
  }
  
  // ... create notifications
}
```

### 4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
// –í SupplierOrder - –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å —É–∂–µ —Ç–∞–∫–æ–π
if (status === currentStatus) {
  console.log('‚ö†Ô∏è –°—Ç–∞—Ç—É—Å –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è');
  return;
}
```

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–†–∞–±–æ—Ç–∞–µ—Ç**: ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
**–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**: ‚ùå –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏—á–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, –∫–∞–Ω–∞–ª—ã, —à–∞–±–ª–æ–Ω—ã)
**–ü—Ä–æ–±–ª–µ–º—ã**: ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏, –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥, –Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–û—Ü–µ–Ω–∫–∞**: 6/10

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –Ω—É–∂–¥, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏.

