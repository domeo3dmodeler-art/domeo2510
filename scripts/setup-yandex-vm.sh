#!/bin/bash

# ðŸš€ Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ubuntu VM Ð´Ð»Ñ Yandex Cloud
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ: ./setup-yandex-vm.sh

set -e

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
log() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
    exit 1
}

warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
update_system() {
    log "ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ..."
    sudo apt update -y
    sudo apt upgrade -y
    sudo apt autoremove -y
    sudo apt autoclean
    log "âœ… Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°"
}

# ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
clean_system() {
    log "Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÑƒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹..."
    
    # ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
    sudo systemctl stop nginx 2>/dev/null || true
    sudo systemctl stop docker 2>/dev/null || true
    sudo systemctl stop postgresql 2>/dev/null || true
    sudo systemctl stop redis 2>/dev/null || true
    
    # Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð²ÑÐµÑ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
    sudo apt remove --purge -y \
        nginx \
        nginx-common \
        nginx-core \
        docker.io \
        docker-ce \
        docker-ce-cli \
        containerd.io \
        docker-compose \
        postgresql \
        postgresql-client \
        postgresql-contrib \
        redis-server \
        redis-tools \
        nodejs \
        npm \
        yarn \
        git \
        curl \
        wget \
        unzip \
        htop \
        vim \
        nano \
        2>/dev/null || true
    
    # ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
    sudo rm -rf /etc/nginx
    sudo rm -rf /var/www
    sudo rm -rf /var/lib/docker
    sudo rm -rf /var/lib/postgresql
    sudo rm -rf /var/lib/redis
    sudo rm -rf /home/ubuntu/.docker
    sudo rm -rf /home/ubuntu/.npm
    sudo rm -rf /home/ubuntu/.yarn
    sudo rm -rf /home/ubuntu/.git
    
    # ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²
    sudo rm -rf /var/log/nginx
    sudo rm -rf /var/log/docker
    sudo rm -rf /var/log/postgresql
    sudo rm -rf /var/log/redis
    
    # ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
    sudo rm -rf /tmp/*
    sudo rm -rf /var/tmp/*
    
    # ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÑÑˆÐ° Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
    sudo apt clean
    sudo apt autoremove -y
    sudo apt autoclean
    
    log "âœ… Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð°"
}

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
install_packages() {
    log "Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹..."
    
    # Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹
    sudo apt update
    sudo apt install -y \
        curl \
        wget \
        git \
        unzip \
        htop \
        vim \
        nano \
        ufw \
        fail2ban \
        certbot \
        python3-certbot-nginx
    
    log "âœ… Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
}

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Docker
install_docker() {
    log "Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Docker..."
    
    # Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð²ÐµÑ€ÑÐ¸Ð¹
    sudo apt remove -y docker docker-engine docker.io containerd runc 2>/dev/null || true
    
    # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
    sudo apt install -y \
        ca-certificates \
        gnupg \
        lsb-release
    
    # Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ GPG ÐºÐ»ÑŽÑ‡Ð° Docker
    sudo mkdir -p /etc/apt/keyrings
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    
    # Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ Docker
    echo \
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
        $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    
    # ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ð¾Ð² Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Docker
    sudo apt update
    sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    
    # Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ docker
    sudo usermod -aG docker ubuntu
    
    # Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¸ Ð·Ð°Ð¿ÑƒÑÐº Docker
    sudo systemctl enable docker
    sudo systemctl start docker
    
    log "âœ… Docker ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
}

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Docker Compose
install_docker_compose() {
    log "Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Docker Compose..."
    
    # ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸
    DOCKER_COMPOSE_VERSION=$(curl -s https://api.github.com/repos/docker/compose/releases/latest | grep 'tag_name' | cut -d\" -f4)
    
    # Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
    sudo curl -L "https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
    sudo chmod +x /usr/local/bin/docker-compose
    
    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑÑ‹Ð»ÐºÐ¸
    sudo ln -sf /usr/local/bin/docker-compose /usr/bin/docker-compose
    
    log "âœ… Docker Compose ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ (Ð²ÐµÑ€ÑÐ¸Ñ: $DOCKER_COMPOSE_VERSION)"
}

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð°
setup_firewall() {
    log "ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»..."
    
    # Ð¡Ð±Ñ€Ð¾Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»
    sudo ufw --force reset
    
    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸Ðº Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
    sudo ufw default deny incoming
    sudo ufw default allow outgoing
    
    # Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ SSH
    sudo ufw allow ssh
    
    # Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ HTTP Ð¸ HTTPS
    sudo ufw allow 80/tcp
    sudo ufw allow 443/tcp
    
    # Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)
    sudo ufw allow 3000/tcp
    
    # Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð°
    sudo ufw --force enable
    
    log "âœ… Ð¤Ð°Ð¹Ñ€Ð²Ð¾Ð» Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
}

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° fail2ban
setup_fail2ban() {
    log "ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ fail2ban..."
    
    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ SSH
    sudo tee /etc/fail2ban/jail.local > /dev/null <<EOF
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3

[sshd]
enabled = true
port = ssh
logpath = /var/log/auth.log
maxretry = 3
EOF
    
    # ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº fail2ban
    sudo systemctl enable fail2ban
    sudo systemctl restart fail2ban
    
    log "âœ… fail2ban Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
}

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
create_app_directory() {
    log "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ..."
    
    sudo mkdir -p /opt/domeo
    sudo chown ubuntu:ubuntu /opt/domeo
    
    log "âœ… Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°: /opt/domeo"
}

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
setup_environment() {
    log "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ„Ð°Ð¹Ð» Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ..."
    
    sudo tee /opt/domeo/.env.production > /dev/null <<EOF
# Production Environment Variables
NODE_ENV=production
PORT=3000

# Database
DATABASE_URL=postgresql://domeo:your_password@db:5432/domeo

# Authentication
NEXTAUTH_SECRET=your-super-secret-key-change-this-in-production
NEXTAUTH_URL=https://yourdomain.com

# AWS/Yandex Object Storage
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_REGION=ru-central1
AWS_S3_BUCKET=your-bucket-name

# Monitoring
PROMETHEUS_PORT=9090
GRAFANA_PORT=3001
EOF
    
    sudo chown ubuntu:ubuntu /opt/domeo/.env.production
    sudo chmod 600 /opt/domeo/.env.production
    
    log "âœ… Ð¤Ð°Ð¹Ð» Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½"
}

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ systemd ÑÐµÑ€Ð²Ð¸ÑÐ°
create_systemd_service() {
    log "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ systemd ÑÐµÑ€Ð²Ð¸Ñ..."
    
    sudo tee /etc/systemd/system/domeo.service > /dev/null <<EOF
[Unit]
Description=Domeo Application
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/domeo
ExecStart=/usr/bin/docker-compose -f docker-compose.production.yml up -d
ExecStop=/usr/bin/docker-compose -f docker-compose.production.yml down
TimeoutStartSec=0
User=ubuntu
Group=ubuntu

[Install]
WantedBy=multi-user.target
EOF
    
    sudo systemctl daemon-reload
    sudo systemctl enable domeo.service
    
    log "âœ… Systemd ÑÐµÑ€Ð²Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½"
}

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
create_management_scripts() {
    log "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ..."
    
    # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°
    sudo tee /opt/domeo/start.sh > /dev/null <<'EOF'
#!/bin/bash
cd /opt/domeo
docker-compose -f docker-compose.production.yml up -d
echo "Domeo application started"
EOF
    
    # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸
    sudo tee /opt/domeo/stop.sh > /dev/null <<'EOF'
#!/bin/bash
cd /opt/domeo
docker-compose -f docker-compose.production.yml down
echo "Domeo application stopped"
EOF
    
    # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°
    sudo tee /opt/domeo/restart.sh > /dev/null <<'EOF'
#!/bin/bash
cd /opt/domeo
docker-compose -f docker-compose.production.yml down
docker-compose -f docker-compose.production.yml up -d
echo "Domeo application restarted"
EOF
    
    # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
    sudo tee /opt/domeo/update.sh > /dev/null <<'EOF'
#!/bin/bash
cd /opt/domeo

echo "Stopping application..."
docker-compose -f docker-compose.production.yml down

echo "Pulling latest changes..."
git pull origin main

echo "Rebuilding and starting..."
docker-compose -f docker-compose.production.yml up -d --build

echo "Domeo application updated"
EOF
    
    # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
    sudo tee /opt/domeo/status.sh > /dev/null <<'EOF'
#!/bin/bash
cd /opt/domeo
echo "=== Docker Containers ==="
docker-compose -f docker-compose.production.yml ps

echo ""
echo "=== Application Health ==="
curl -f http://localhost:3000/api/health && echo "âœ… Health OK" || echo "âŒ Health FAILED"

echo ""
echo "=== Resource Usage ==="
docker stats --no-stream
EOF
    
    # Ð”ÐµÐ»Ð°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼Ð¸
    sudo chmod +x /opt/domeo/*.sh
    sudo chown ubuntu:ubuntu /opt/domeo/*.sh
    
    log "âœ… Ð¡ÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹"
}

# ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ
main() {
    log "ðŸš€ ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÑƒ Ubuntu VM Ð´Ð»Ñ Yandex Cloud"
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð°Ð² root
    if [ "$EUID" -eq 0 ]; then
        error "ÐÐµ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ð¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¾Ñ‚ root. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ: sudo ./setup-yandex-vm.sh"
    fi
    
    update_system
    clean_system
    install_packages
    install_docker
    install_docker_compose
    setup_firewall
    setup_fail2ban
    create_app_directory
    setup_environment
    create_systemd_service
    create_management_scripts
    
    log "ðŸŽ‰ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° VM Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!"
    log "ðŸ“ Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ: /opt/domeo"
    log "ðŸ”§ Ð¡ÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ: /opt/domeo/*.sh"
    log "âš™ï¸ Systemd ÑÐµÑ€Ð²Ð¸Ñ: domeo.service"
    log ""
    log "Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
    log "1. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ ÐºÐ¾Ð´ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð² /opt/domeo"
    log "2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð² .env.production"
    log "3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ: sudo systemctl start domeo"
}

# ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
trap 'error "ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² ÑÑ‚Ñ€Ð¾ÐºÐµ $LINENO"' ERR

# Ð—Ð°Ð¿ÑƒÑÐº Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
main "$@"
