# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö DOMEO

## –û–±–∑–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

–ü–æ—Å–ª–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã—è–≤–ª–µ–Ω—ã **8 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º** —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:

1. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö**
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö**
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é**
4. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã**
5. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö**
7. **–ü—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**

---

## 1. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–º–µ–µ—Ç —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö:

#### 1.1 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

```sql
-- –í Product —Ç–∞–±–ª–∏—Ü–µ
properties_data String @default("{}")  -- JSON —Å–≤–æ–π—Å—Ç–≤–∞
specifications  String @default("{}")  -- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö

-- –í ImportTemplate
template_config String?     -- JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
field_mappings  String?     -- JSON –º–∞–ø–ø–∏–Ω–≥
validation_rules String?    -- JSON –ø—Ä–∞–≤–∏–ª–∞
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ JSON —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—è—Ö
- –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø–æ–ª—è–º–∏
- –í–æ–∑–º–æ–∂–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

#### 1.2 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

```prisma
model Product {
  catalog_category_id String  // –ù–µ—Ç @relation!
  // ...
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
- –ù–µ—Ç –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- –ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

#### 1.3 –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

```prisma
model Product {
  base_price Float        // Float –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º
  stock_quantity Int      // –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
  currency String @default("RUB")  // –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–∞–ª—é—Ç
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 1.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

```sql
-- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
ALTER TABLE products 
ADD CONSTRAINT fk_products_category 
FOREIGN KEY (catalog_category_id) 
REFERENCES catalog_categories(id) 
ON DELETE CASCADE;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º FK
SELECT COUNT(*) FROM products p 
LEFT JOIN catalog_categories c ON p.catalog_category_id = c.id 
WHERE c.id IS NULL;
```

#### 1.2 –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è JSON –ø–æ–ª–µ–π

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–≤–æ–π—Å—Ç–≤
CREATE TABLE product_properties (
  id VARCHAR(50) PRIMARY KEY,
  product_id VARCHAR(50) NOT NULL,
  property_name VARCHAR(100) NOT NULL,
  property_value TEXT NOT NULL,
  property_type VARCHAR(20) DEFAULT 'text',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
  UNIQUE(product_id, property_name)
);
```

---

## 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:

#### 2.1 –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤

```typescript
// –í ProductImportService - –ù–ï–¢ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!
for (const productData of products) {
  const existingProduct = await prisma.product.findUnique({
    where: { sku: productData.sku }
  });
  
  if (existingProduct) {
    await prisma.product.update({ /* ... */ });
  } else {
    await prisma.product.create({ /* ... */ });
  }
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —á–∞—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è, —á–∞—Å—Ç—å –Ω–µ—Ç
- –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### 2.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤

```typescript
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
await prisma.catalogCategory.update({
  where: { id: catalogCategoryId },
  data: { products_count: { increment: importedCount } }
});
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ –∞—Ç–æ–º–∞—Ä–Ω–æ —Å –∏–º–ø–æ—Ä—Ç–æ–º —Ç–æ–≤–∞—Ä–æ–≤
- –í–æ–∑–º–æ–∂–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Å—á–µ—Ç—á–∏–∫–∞—Ö

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 2.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```typescript
// –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–º–ø–æ—Ä—Ç —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
async importProducts(products: ProductData[]): Promise<ImportResult> {
  return await prisma.$transaction(async (tx) => {
    const results = {
      imported: 0,
      updated: 0,
      errors: []
    };
    
    for (const productData of products) {
      try {
        const existingProduct = await tx.product.findUnique({
          where: { sku: productData.sku }
        });
        
        if (existingProduct) {
          await tx.product.update({
            where: { sku: productData.sku },
            data: productData
          });
          results.updated++;
        } else {
          await tx.product.create({
            data: productData
          });
          results.imported++;
        }
      } catch (error) {
        results.errors.push({
          sku: productData.sku,
          error: error.message
        });
      }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–º–ø–æ—Ä—Ç —É—Å–ø–µ—à–µ–Ω
    if (results.errors.length === 0) {
      await tx.catalogCategory.update({
        where: { id: catalogCategoryId },
        data: { 
          products_count: { 
            increment: results.imported + results.updated 
          } 
        }
      });
    }
    
    return results;
  });
}
```

---

## 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—É:

#### 3.1 Race Conditions –≤ –∏–º–ø–æ—Ä—Ç–µ

```typescript
// –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç —Ç–æ–≤–∞—Ä—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
const existingProduct = await prisma.product.findUnique({
  where: { sku: productData.sku }
});

if (existingProduct) {
  // –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
  await prisma.product.update({ /* ... */ });
}
```

#### 3.2 –ü—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–µ–º

```typescript
// –ö—ç—à –≤ –ø–∞–º—è—Ç–∏ - –Ω–µ thread-safe
const completeDataCache = new Map<string, { data: any, timestamp: number }>();

// –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≥–æ–Ω–∫–µ —É—Å–ª–æ–≤–∏–π
if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
  return cached.data; // –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–æ–º
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 3.1 –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
model Product {
  id        String @id @default(cuid())
  sku       String @unique
  version   Int    @default(1)  // –í–µ—Ä—Å–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–µ—Ä—Å–∏–∏
async updateProduct(id: string, data: any, expectedVersion: number) {
  return await prisma.product.update({
    where: { 
      id: id,
      version: expectedVersion  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é
    },
    data: {
      ...data,
      version: { increment: 1 }  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏—é
    }
  });
}
```

#### 3.2 –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫—ç—à

```typescript
// Thread-safe –∫—ç—à —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
class SafeCache {
  private cache = new Map<string, { data: any, timestamp: number }>();
  private locks = new Map<string, Promise<any>>();
  
  async getOrSet<T>(key: string, fetchFn: () => Promise<T>, ttl: number): Promise<T> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    if (this.locks.has(key)) {
      return await this.locks.get(key);
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    const promise = this._getOrSetInternal(key, fetchFn, ttl);
    this.locks.set(key, promise);
    
    try {
      return await promise;
    } finally {
      this.locks.delete(key);
    }
  }
  
  private async _getOrSetInternal<T>(key: string, fetchFn: () => Promise<T>, ttl: number): Promise<T> {
    const cached = this.cache.get(key);
    if (cached && Date.now() - cached.timestamp < ttl) {
      return cached.data;
    }
    
    const data = await fetchFn();
    this.cache.set(key, { data, timestamp: Date.now() });
    return data;
  }
}
```

---

## 4. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:

#### 4.1 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

```sql
-- –¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
@@index([catalog_category_id])
@@index([is_active])

-- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
-- WHERE catalog_category_id = ? AND is_active = true
```

#### 4.2 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è JSON –ø–æ–ª–µ–π

```sql
-- –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ JSON
properties_data String @default("{}")  -- –ù–µ—Ç GIN –∏–Ω–¥–µ–∫—Å–∞
```

#### 4.3 –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

```sql
-- –í PostgreSQL –µ—Å—Ç—å GIN –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_products_data ON products USING GIN(data);

-- –í SQLite –Ω–µ—Ç —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–∞
```

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 4.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

```sql
-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
CREATE INDEX IF NOT EXISTS idx_products_category_active 
ON products (catalog_category_id, is_active);

CREATE INDEX IF NOT EXISTS idx_products_created_at 
ON products (created_at DESC);

CREATE INDEX IF NOT EXISTS idx_products_sku_active 
ON products (sku, is_active);
```

#### 4.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏
async getProductsByCategory(categoryId: string, isActive: boolean = true) {
  return await prisma.product.findMany({
    where: {
      catalog_category_id: categoryId,  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å
      is_active: isActive
    },
    select: {
      id: true,
      sku: true,
      name: true,
      base_price: true
      // –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç—è–∂–µ–ª—ã–µ JSON –ø–æ–ª—è
    },
    orderBy: {
      created_at: 'desc'  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å created_at
    },
    take: 100  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  });
}
```

---

## 5. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è:

#### 5.1 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤

```typescript
// –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –±—ç–∫–∞–ø —á–µ—Ä–µ–∑ API
export async function GET(request: Request) {
  // –°–æ–∑–¥–∞–µ—Ç Excel —Ñ–∞–π–ª, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ
  const excelData = await buildExcelData();
  return new Response(excelBuffer, {
    headers: { 'Content-Type': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }
  });
}
```

#### 5.2 –ù–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –±—ç–∫–∞–ø–∞

```typescript
// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –Ω–µ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
export async function POST(request: Request) {
  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ catalog_categories
  // –¢–æ–≤–∞—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
}
```

#### 5.3 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤

- –ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–∞—Ç—É
- –ù–µ—Ç —Å–∂–∞—Ç–∏—è –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 5.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

```typescript
// –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
class BackupService {
  async createFullBackup(): Promise<BackupInfo> {
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const backupId = `backup_${timestamp}`;
    
    // –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
    const tables = ['products', 'catalog_categories', 'users', 'clients'];
    const backupData = {};
    
    for (const table of tables) {
      backupData[table] = await prisma[table].findMany();
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
    const backupPath = `./backups/${backupId}.json`;
    await fs.writeFile(backupPath, JSON.stringify(backupData, null, 2));
    
    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    await prisma.backupHistory.create({
      data: {
        id: backupId,
        type: 'full',
        tables: tables,
        record_count: Object.values(backupData).reduce((sum, arr) => sum + arr.length, 0),
        file_path: backupPath,
        created_at: new Date()
      }
    });
    
    return { id: backupId, path: backupPath };
  }
  
  async restoreFromBackup(backupId: string): Promise<void> {
    const backup = await prisma.backupHistory.findUnique({
      where: { id: backupId }
    });
    
    if (!backup) {
      throw new Error(`Backup ${backupId} not found`);
    }
    
    const backupData = JSON.parse(await fs.readFile(backup.file_path, 'utf8'));
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    await prisma.$transaction(async (tx) => {
      for (const [tableName, records] of Object.entries(backupData)) {
        // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        await tx[tableName].deleteMany();
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        if (records.length > 0) {
          await tx[tableName].createMany({
            data: records
          });
        }
      }
    });
  }
}
```

---

## 6. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–î–∞–Ω–Ω—ã–µ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º:

#### 6.1 –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JSON –ø–æ–ª–µ–π

```typescript
// properties_data –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á—Ç–æ —É–≥–æ–¥–Ω–æ
const product = await prisma.product.create({
  data: {
    properties_data: "invalid json"  // –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏
  }
});
```

#### 6.2 –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

```typescript
// –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π
const product = await prisma.product.create({
  data: {
    base_price: -100  // –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  }
});
```

#### 6.3 –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

```typescript
// –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const product1 = await prisma.product.create({ data: { sku: "ABC123" } });
const product2 = await prisma.product.create({ data: { sku: "ABC123" } }); // –û—à–∏–±–∫–∞
```

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 6.1 –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Prisma

```prisma
model Product {
  id                  String          @id @default(cuid())
  sku                 String          @unique
  name                String          @db.VarChar(255)
  base_price          Decimal         @db.Decimal(10,2) // –¢–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –¥–µ–Ω–µ–≥
  stock_quantity      Int             @default(0)
  currency            String          @default("RUB") @db.VarChar(3)
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ middleware
  @@map("products")
}
```

#### 6.2 –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```typescript
// –°–µ—Ä–≤–∏—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏
class ProductValidationService {
  validateProduct(data: any): ValidationResult {
    const errors: string[] = [];
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è SKU
    if (!data.sku || typeof data.sku !== 'string' || data.sku.length < 3) {
      errors.push('SKU –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –¥–ª–∏–Ω–æ–π –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤');
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω—ã
    if (data.base_price && (data.base_price < 0 || data.base_price > 1000000)) {
      errors.push('–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 1,000,000');
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è JSON –ø–æ–ª–µ–π
    if (data.properties_data) {
      try {
        JSON.parse(data.properties_data);
      } catch {
        errors.push('properties_data –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º JSON');
      }
    }
    
    return {
      isValid: errors.length === 0,
      errors
    };
  }
}

// Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
prisma.$use(async (params, next) => {
  if (params.model === 'Product' && params.action === 'create') {
    const validation = new ProductValidationService().validateProduct(params.args.data);
    if (!validation.isValid) {
      throw new Error(`Validation failed: ${validation.errors.join(', ')}`);
    }
  }
  
  return next(params);
});
```

---

## 7. –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–æ—Å—Ç—É:

#### 7.1 –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç—å

```typescript
// –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –ø–∞–º—è—Ç—å
const products = await prisma.product.findMany({
  take: 5000  // –í—Å–µ —Ä–∞–≤–Ω–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
});

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ –ø–∞–º—è—Ç–∏
const filteredProducts = products.filter(product => {
  // –ú–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
});
```

#### 7.2 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

```typescript
// –ù–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ API
export async function GET(request: NextRequest) {
  const products = await prisma.product.findMany({
    // –ù–µ—Ç limit, offset, cursor
  });
}
```

#### 7.3 –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

```typescript
// N+1 –ø—Ä–æ–±–ª–µ–º–∞
const categories = await prisma.catalogCategory.findMany();
for (const category of categories) {
  const products = await prisma.product.findMany({
    where: { catalog_category_id: category.id }
  }); // N –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 7.1 –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è

```typescript
// –ö—É—Ä—Å–æ—Ä–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
async getProductsPaginated(cursor?: string, limit: number = 50) {
  return await prisma.product.findMany({
    take: limit,
    skip: cursor ? 1 : undefined,
    cursor: cursor ? { id: cursor } : undefined,
    orderBy: { id: 'asc' },
    select: {
      id: true,
      sku: true,
      name: true,
      base_price: true
      // –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç—è–∂–µ–ª—ã–µ –ø–æ–ª—è
    }
  });
}
```

#### 7.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
// –†–µ—à–µ–Ω–∏–µ N+1 –ø—Ä–æ–±–ª–µ–º—ã
const categoriesWithProducts = await prisma.catalogCategory.findMany({
  include: {
    products: {
      select: {
        id: true,
        sku: true,
        name: true
      },
      take: 10  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
    }
  }
});
```

---

## 8. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î:

#### 8.1 –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```typescript
// –ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
const products = await prisma.product.findMany({
  // –ú–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è 10 —Å–µ–∫—É–Ω–¥, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç
});
```

#### 8.2 –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫

```typescript
// –û—à–∏–±–∫–∏ –ë–î –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
try {
  await prisma.product.create({ data: invalidData });
} catch (error) {
  // –û—à–∏–±–∫–∞ —Ç–µ—Ä—è–µ—Ç—Å—è
}
```

#### 8.3 –ù–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤

- –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î
- –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- –ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 8.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
// Middleware –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
prisma.$use(async (params, next) => {
  const start = Date.now();
  
  try {
    const result = await next(params);
    const duration = Date.now() - start;
    
    // –õ–æ–≥–∏—Ä—É–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    if (duration > 1000) {
      console.warn(`Slow query: ${params.model}.${params.action} took ${duration}ms`);
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
    await sendMetrics({
      model: params.model,
      action: params.action,
      duration,
      success: true
    });
    
    return result;
  } catch (error) {
    const duration = Date.now() - start;
    
    // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    console.error(`Database error: ${params.model}.${params.action}`, error);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–æ–∫
    await sendMetrics({
      model: params.model,
      action: params.action,
      duration,
      success: false,
      error: error.message
    });
    
    throw error;
  }
});
```

#### 8.2 –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤

```typescript
// –°–µ—Ä–≤–∏—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
class DatabaseMonitoringService {
  async checkDatabaseHealth(): Promise<HealthStatus> {
    const checks = await Promise.allSettled([
      this.checkConnection(),
      this.checkSlowQueries(),
      this.checkDiskSpace(),
      this.checkErrorRate()
    ]);
    
    const status = checks.every(check => 
      check.status === 'fulfilled' && check.value.healthy
    ) ? 'healthy' : 'unhealthy';
    
    if (status === 'unhealthy') {
      await this.sendAlert(checks);
    }
    
    return { status, checks };
  }
  
  private async sendAlert(checks: PromiseSettledResult<any>[]): Promise<void> {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
    console.error('Database health check failed:', checks);
  }
}
```

---

## –ü–ª–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1 –Ω–µ–¥–µ–ª—è)

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ FK
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–æ–ø–∏–∏ –ë–î

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –∏–º–ø–æ—Ä—Ç
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (2 –Ω–µ–¥–µ–ª–∏)

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤**
   - –ê–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –†–µ—à–µ–Ω–∏–µ N+1 –ø—Ä–æ–±–ª–µ–º
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –≠—Ç–∞–ø 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (1 –Ω–µ–¥–µ–ª—è)

1. **–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ê–ª–µ—Ä—Ç—ã –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

2. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 3-5 —Ä–∞–∑
- üìà –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üîÑ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- üìä –í–∏–¥–∏–º–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- üö® –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- üìà –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —è–≤–ª—è—é—Ç—Å—è **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã. –û–Ω–∏ –≤–ª–∏—è—é—Ç –Ω–∞:

- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∏–Ω–¥–µ–∫—Å—ã, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å **–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö** –∏ **–¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π—Ç–∏ –∫ **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –∏ **–≤–Ω–µ–¥—Ä–µ–Ω–∏—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**.

–í—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è **–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏** –∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –Ω–∞—Ä—É—à–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏.
