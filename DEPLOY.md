# Команды для деплоя на ВМ

## SSH подключение и деплой

```bash
# 1. Подключение к ВМ (замените на ваши данные)
ssh ubuntu@130.193.40.35

# 2. Переход в директорию проекта
cd /opt/domeo

# 3. Получение последних изменений
git pull origin main

# 4. Пересборка Docker образа
docker compose -f docker-compose.staging.yml build staging-app

# 5. Перезапуск контейнеров
docker compose -f docker-compose.staging.yml up -d --force-recreate staging-app

# 6. Проверка статуса контейнеров
docker compose -f docker-compose.staging.yml ps

# 7. Просмотр логов (если нужно)
docker compose -f docker-compose.staging.yml logs -f staging-app
```

## Что было исправлено

1. **Унификация статусов Order**:
   - Order всегда показывает свой статус (NEW_PLANNED, UNDER_REVIEW, и т.д.), а не статус Invoice
   - Создан модуль `lib/utils/order-status-display.ts` для унификации отображения статусов
   - Один и тот же Order имеет одинаковый статус в списках Executor и Complectator

2. **Исправление экспорта**:
   - Экспорт счета использует `cart_data` из Order если нет Invoice
   - Экспорт заказа у поставщика работает корректно

3. **Отображение товаров**:
   - Модальное окно OrderDetailModal использует `cart_data` из Order если нет Invoice
   - Добавлено отображение размеров товаров (width × height)
   - Исправлена логика получения `cart_data` в GET /api/orders/[id]

## Проверка после деплоя

1. **Логика статусов**:
   - Открыть ЛК исполнителя (`/executor/dashboard`)
   - Открыть ЛК комплектатора (`/complectator/dashboard`)
   - Проверить что один и тот же Order имеет одинаковый статус в обоих списках
   - Проверить фильтры по статусам

2. **Модальное окно заказа**:
   - Открыть любой заказ в ЛК исполнителя (кнопка с иконкой глаза)
   - Проверить отображение товаров в блоке "Товары"
   - Убедиться что товары отображаются с правильными данными (название, количество, цена, размеры)

3. **Экспорт**:
   - Экспорт счета (кнопка "Оплаченный счет") - должен работать только для статуса PAID
   - Экспорт заказа у поставщика (кнопка "Заказ из БД") - должен генерировать Excel файл
   - Убедиться что файлы генерируются корректно

4. **Наличие данных**:
   - Убедиться что в заказах есть `cart_data` (либо в Order, либо в Invoice)
   - Проверить что товары отображаются с правильными данными
