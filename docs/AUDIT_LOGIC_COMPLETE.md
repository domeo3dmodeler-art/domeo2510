# üîç –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ª–æ–≥–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã Domeo

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞**: 2025-01-11  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã**: 1.0  
**–°—Ç–∞—Ç—É—Å**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
3. [–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–¥–∞](#–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏-–∏-–∫–æ–¥–∞)
4. [–ü—Ä–æ–±–ª–µ–º—ã –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤](#–ø—Ä–æ–±–ª–µ–º—ã-–ª–æ–≥–∏–∫–∏-—Å—Ç–∞—Ç—É—Å–æ–≤)
5. [–ü—Ä–æ–±–ª–µ–º—ã –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏](#–ø—Ä–æ–±–ª–µ–º—ã-–¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏)
6. [–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞](#–ø—Ä–æ–±–ª–µ–º—ã-–ø—Ä–∞–≤-–¥–æ—Å—Ç—É–ø–∞)
7. [–ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏](#–ø—Ä–æ–±–ª–µ–º—ã-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
8. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Frontend**: Next.js 15, React 19, TypeScript
- **Backend**: Next.js API Routes, Prisma ORM
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: SQLite (dev), PostgreSQL (prod)
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT —Å —Ä–æ–ª–µ–≤–æ–π –º–æ–¥–µ–ª—å—é

### –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
1. **Order** (–ó–∞–∫–∞–∑) - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç
2. **Invoice** (–°—á–µ—Ç) - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
3. **Quote** (–ö–ü) - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
4. **SupplierOrder** (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞) - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **ADMIN** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- **COMPLECTATOR** - –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ PAID)
- **EXECUTOR** - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ PAID)
- **MANAGER** - —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ Order –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∫–∞–∑–∞–Ω—ã –æ–¥–Ω–∏ —Å—Ç–∞—Ç—É—Å—ã, –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥—Ä—É–≥–∏–µ.

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`ORDER_STATUS_CHAIN.md`):
```
DRAFT ‚Üí SENT ‚Üí PAID ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED
```

**–ö–æ–¥** (`lib/validation/status-transitions.ts`):
```typescript
order: {
  'DRAFT': ['SENT', 'CANCELLED'],
  'SENT': ['PAID', 'CANCELLED'],
  'PAID': ['UNDER_REVIEW', 'CANCELLED'],
  'NEW_PLANNED': ['UNDER_REVIEW', 'CANCELLED'],  // ‚ö†Ô∏è NEW_PLANNED –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ —Ü–µ–ø–æ—á–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
  'UNDER_REVIEW': ['AWAITING_MEASUREMENT', 'AWAITING_INVOICE', 'CANCELLED'],
  'AWAITING_MEASUREMENT': ['AWAITING_INVOICE', 'CANCELLED'],
  'AWAITING_INVOICE': ['COMPLETED', 'CANCELLED'],
  'COMPLETED': [],
  'CANCELLED': []
}
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
- `NEW_PLANNED` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ, –Ω–æ –Ω–µ –æ–ø–∏—Å–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–µ–ø–æ—á–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ `PAID` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ `NEW_PLANNED` –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, –Ω–æ –≤ –∫–æ–¥–µ `NEW_PLANNED` - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
- –ù–µ—Ç —á–µ—Ç–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–æ–≥–¥–∞ Order —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DRAFT`, –∞ –∫–æ–≥–¥–∞ `NEW_PLANNED`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**:
- `docs/ORDER_STATUS_CHAIN.md` (—Å—Ç—Ä–æ–∫–∞ 5-16)
- `lib/validation/status-transitions.ts` (—Å—Ç—Ä–æ–∫–∞ 21-31)
- `app/api/orders/route.ts` (—Å—Ç—Ä–æ–∫–∞ 374) - —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DRAFT`
- `app/api/invoices/[id]/status/route.ts` (—Å—Ç—Ä–æ–∫–∞ 190) - –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice Order –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `NEW_PLANNED`

---

### 2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ Invoice –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–¥–µ

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`DOCUMENT_LOGIC_COMPLETE.md`):
```
DRAFT ‚Üí SENT ‚Üí PAID ‚Üí ORDERED ‚Üí RECEIVED_FROM_SUPPLIER ‚Üí COMPLETED
```

**–ö–æ–¥** (`lib/validation/status-transitions.ts`):
```typescript
invoice: {
  'DRAFT': ['SENT', 'CANCELLED'],
  'SENT': ['PAID', 'CANCELLED'],
  'PAID': ['ORDERED', 'CANCELLED'],  // ‚ö†Ô∏è ORDERED –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
  'ORDERED': ['RECEIVED_FROM_SUPPLIER', 'CANCELLED'],
  'RECEIVED_FROM_SUPPLIER': ['COMPLETED', 'CANCELLED'],
  'COMPLETED': [],
  'CANCELLED': []
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ç—É—Å `ORDERED` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–µ, –Ω–æ –Ω–µ –æ–ø–∏—Å–∞–Ω –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø.

---

### 3. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ Order –≤ —Ä–∞–∑–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

**`SYSTEM_RULES_AND_PERMISSIONS.md`** (—Å—Ç—Ä–æ–∫–∞ 199-212):
```
DRAFT ‚Üí CONFIRMED ‚Üí IN_PRODUCTION ‚Üí READY ‚Üí COMPLETED
```

**`ORDER_STATUS_CHAIN.md`** (—Å—Ç—Ä–æ–∫–∞ 5-16):
```
DRAFT ‚Üí SENT ‚Üí PAID ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED
```

**`DOCUMENT_LOGIC_COMPLETE.md`** (—Å—Ç—Ä–æ–∫–∞ 147-174):
```
NEW_PLANNED ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –¢—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ Order –≤ —Ä–∞–∑–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö!

---

### 4. –ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ Order ‚Üî Invoice

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Ü–∏–∫–ª–∞–º.

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 152-194):
```typescript
// Order ‚Üí Invoice —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
const statusMapping: Record<string, string> = {
  'NEW_PLANNED': 'DRAFT',
  'UNDER_REVIEW': 'DRAFT',
  'AWAITING_MEASUREMENT': 'SENT',
  'AWAITING_INVOICE': 'SENT',
  'COMPLETED': 'PAID',
  'CANCELLED': 'CANCELLED'
};
```

**–ö–æ–¥** (`app/api/invoices/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 172-234):
```typescript
// Invoice ‚Üí Order —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
switch (status) {
  case 'PAID':
    orderStatus = 'NEW_PLANNED';
    break;
  case 'ORDERED':
    orderStatus = 'AWAITING_INVOICE';
    break;
  // ...
}
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Order —Å—Ç–∞—Ç—É—Å–∞ `UNDER_REVIEW` ‚Üí Invoice —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `DRAFT`, –Ω–æ Invoice —É–∂–µ –º–æ–≥ –±—ã—Ç—å `SENT` –∏–ª–∏ `PAID`
2. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Invoice `PAID` ‚Üí Order —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `NEW_PLANNED`, –Ω–æ Order —É–∂–µ –º–æ–≥ –±—ã—Ç—å `UNDER_REVIEW`
3. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
4. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

---

### 5. –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`ORDER_STATUS_CHAIN.md`, —Å—Ç—Ä–æ–∫–∞ 66-74):
> –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç:
> - ‚úÖ **PAID** ‚Üí **UNDER_REVIEW** –∏–ª–∏ **CANCELLED**

**–ö–æ–¥** (`lib/auth/permissions.ts`, —Å—Ç—Ä–æ–∫–∞ 148-158):
```typescript
if (roleStr === 'complectator') {
  const executorStatuses = ['NEW_PLANNED', 'UNDER_REVIEW', 'AWAITING_MEASUREMENT', 'AWAITING_INVOICE', 'COMPLETED'];
  if (documentStatus && executorStatuses.includes(documentStatus)) {
    return false;  // ‚ö†Ô∏è –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –ù–ï –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
  }
  return true;  // ‚ö†Ô∏è –ù–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å PAID
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ `PAID` ‚Üí `UNDER_REVIEW`, –Ω–æ –∫–æ–¥ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ `UNDER_REVIEW` –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ:
- –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ `PAID` ‚Üí `UNDER_REVIEW`
- –ù–æ –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å `UNDER_REVIEW` –æ–±—Ä–∞—Ç–Ω–æ –∏–ª–∏ –¥–∞–ª—å—à–µ

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 59):
```typescript
if (userRole === 'complectator' && ['NEW_PLANNED', 'UNDER_REVIEW', ...].includes(order.status)) {
  return NextResponse.json({ error: '–ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞' });
}
```

–≠—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è `UNDER_REVIEW`, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω —Å–∞–º –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏–ª.

---

### 6. –ü—Ä–æ–±–ª–µ–º–∞ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏: —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ —Ä–∞–∑–ª–∏—á–∏—è–º–∏.

**–§–∞–π–ª—ã —Å –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–µ–π**:
1. `app/api/orders/route.ts` (—Å—Ç—Ä–æ–∫–∞ 132-221)
2. `app/api/documents/create/route.ts` (—Å—Ç—Ä–æ–∫–∞ 307-537)
3. `app/api/documents/create-batch/route.ts` (—Å—Ç—Ä–æ–∫–∞ 204-374)

**–†–∞–∑–ª–∏—á–∏—è**:
- –í `orders/route.ts` –ø–æ–∏—Å–∫ –ø–æ `parent_document_id = null` (—Å—Ç—Ä–æ–∫–∞ 157, 186)
- –í `documents/create/route.ts` –ø–æ–∏—Å–∫ –ø–æ `parent_document_id` (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ null)
- –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤: 20 –≤ `orders/route.ts`, 10 –≤ `documents/create/route.ts`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `lib/documents/deduplication.ts`

---

### 7. –ü—Ä–æ–±–ª–µ–º–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: –§—É–Ω–∫—Ü–∏—è `compareCartContent` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ —Ä–∞–∑–ª–∏—á–∏—è–º–∏.

**–§–∞–π–ª—ã**:
- `app/api/orders/route.ts` (—Å—Ç—Ä–æ–∫–∞ 74-130)
- `app/api/documents/create/route.ts` (—Å—Ç—Ä–æ–∫–∞ 257-304)
- `app/api/documents/create-batch/route.ts` (—Å—Ç—Ä–æ–∫–∞ 154-201)

**–†–∞–∑–ª–∏—á–∏—è**:
- –†–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –†–∞–∑–Ω—ã–µ –ª–æ–≥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –†–∞–∑–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–†–∏—Å–∫**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –¥—Ä—É–≥–∏–µ –º–µ—Å—Ç–∞ –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.

---

### 8. –ü—Ä–æ–±–ª–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è Order: —Å—Ç–∞—Ç—É—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ö–æ–¥** (`app/api/orders/route.ts`, —Å—Ç—Ä–æ–∫–∞ 374):
```typescript
status: 'DRAFT', // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º DRAFT
```

**–ù–æ** (`app/api/invoices/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 190):
```typescript
case 'PAID':
  orderStatus = 'NEW_PLANNED';  // –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice Order –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ NEW_PLANNED
```

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- Order —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DRAFT`
- –ù–æ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice Order –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å `NEW_PLANNED`
- –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ `DRAFT` ‚Üí `NEW_PLANNED` –≤ `STATUS_TRANSITIONS`

**–ü—Ä–æ–≤–µ—Ä–∫–∞** (`lib/validation/status-transitions.ts`):
```typescript
order: {
  'DRAFT': ['SENT', 'CANCELLED'],  // ‚ö†Ô∏è –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ NEW_PLANNED
  // ...
}
```

---

### 9. –ü—Ä–æ–±–ª–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 87):
```typescript
if (!canTransitionTo('order', order.status, status)) {
  return NextResponse.json({ error: '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Å—Ç–∞—Ç—É—Å–∞' });
}
```

**–ù–æ** (`lib/validation/status-transitions.ts`, —Å—Ç—Ä–æ–∫–∞ 41-51):
```typescript
export function canTransitionTo(
  documentType: string,
  currentStatus: string,
  newStatus: string
): boolean {
  // ‚ö†Ô∏è –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
  const transitions = STATUS_TRANSITIONS[documentType as keyof typeof STATUS_TRANSITIONS];
  // ...
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –§—É–Ω–∫—Ü–∏—è `canTransitionTo` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞, –Ω–æ –Ω–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–∞–≤–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Ö–æ–¥ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–µ–Ω, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤.

---

### 10. –ü—Ä–æ–±–ª–µ–º–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—è project_file_url

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`ORDER_STATUS_CHAIN.md`, —Å—Ç—Ä–æ–∫–∞ 107):
> **UNDER_REVIEW —Ç—Ä–µ–±—É–µ—Ç project_file_url** - –∑–∞–∫–∞–∑ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç/–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 108-113):
```typescript
if (status === 'UNDER_REVIEW' && !orderWithProject?.project_file_url) {
  return NextResponse.json(
    { error: '–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ —Å—Ç–∞—Ç—É—Å "–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ" —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç/–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É' },
    { status: 400 }
  );
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ `UNDER_REVIEW`, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Order –∏–ª–∏ –ø—Ä–∏ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö. –¢–∞–∫–∂–µ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `project_file_url` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω (—Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç).

---

## ‚ö†Ô∏è –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–¥–∞

### 1. –°—Ç–∞—Ç—É—Å—ã Order

| –î–æ–∫—É–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å—ã Order |
|----------|---------------|
| `SYSTEM_RULES_AND_PERMISSIONS.md` | DRAFT ‚Üí CONFIRMED ‚Üí IN_PRODUCTION ‚Üí READY ‚Üí COMPLETED |
| `ORDER_STATUS_CHAIN.md` | DRAFT ‚Üí SENT ‚Üí PAID ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED |
| `DOCUMENT_LOGIC_COMPLETE.md` | NEW_PLANNED ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED |
| **–ö–æ–¥** (`status-transitions.ts`) | DRAFT ‚Üí SENT ‚Üí PAID ‚Üí NEW_PLANNED ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED |

**–í—ã–≤–æ–¥**: –ù—É–∂–Ω–æ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ –∫–æ–¥.

---

### 2. –°—Ç–∞—Ç—É—Å—ã Invoice

| –î–æ–∫—É–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å—ã Invoice |
|----------|----------------|
| `DOCUMENT_LOGIC_COMPLETE.md` | DRAFT ‚Üí SENT ‚Üí PAID ‚Üí ORDERED ‚Üí RECEIVED_FROM_SUPPLIER ‚Üí COMPLETED |
| `SYSTEM_RULES_AND_PERMISSIONS.md` | DRAFT ‚Üí SENT ‚Üí PAID ‚Üí IN_PRODUCTION ‚Üí RECEIVED_FROM_SUPPLIER ‚Üí COMPLETED |
| **–ö–æ–¥** (`status-transitions.ts`) | DRAFT ‚Üí SENT ‚Üí PAID ‚Üí ORDERED ‚Üí RECEIVED_FROM_SUPPLIER ‚Üí COMPLETED |

**–í—ã–≤–æ–¥**: –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `SYSTEM_RULES_AND_PERMISSIONS.md` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `IN_PRODUCTION`, –≤ –∫–æ–¥–µ `ORDERED`.

---

### 3. –ü—Ä–∞–≤–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ Order

| –î–æ–∫—É–º–µ–Ω—Ç | –ü—Ä–∞–≤–∞ |
|----------|-------|
| `ORDER_STATUS_CHAIN.md` | –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç: PAID ‚Üí UNDER_REVIEW –∏–ª–∏ CANCELLED |
| `SYSTEM_RULES_AND_PERMISSIONS.md` | DRAFT ‚Üí CONFIRMED (–Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è PAID) |
| **–ö–æ–¥** (`permissions.ts`) | –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –¥–æ PAID –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ, –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ PAID ‚Üí UNDER_REVIEW |

**–í—ã–≤–æ–¥**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤–∞.

---

## üîÑ –ü—Ä–æ–±–ª–µ–º—ã –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ DRAFT ‚Üí NEW_PLANNED

**–ü—Ä–æ–±–ª–µ–º–∞**: Order —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DRAFT`, –Ω–æ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å `NEW_PLANNED`. –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞.

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞**:
```
DRAFT ‚Üí SENT ‚Üí PAID ‚Üí NEW_PLANNED (—á–µ—Ä–µ–∑ Invoice)
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ Invoice –æ–ø–ª–∞—á–µ–Ω –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ Order –ø–µ—Ä–µ—à–µ–ª –≤ `SENT`, –ø–µ—Ä–µ—Ö–æ–¥ `DRAFT` ‚Üí `NEW_PLANNED` –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.

---

### 2. –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–∞ NEW_PLANNED

**–ü—Ä–æ–±–ª–µ–º–∞**: `NEW_PLANNED` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫:
1. –°—Ç–∞—Ç—É—Å, –≤ –∫–æ—Ç–æ—Ä—ã–π Order –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice (`app/api/invoices/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 190)
2. –°—Ç–∞—Ç—É—Å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é –≤–º–µ—Å—Ç–æ `PAID` (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

**–í–æ–ø—Ä–æ—Å**: `NEW_PLANNED` - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ `PAID` –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è?

**–ö–æ–¥** (`app/api/orders/route.ts`, —Å—Ç—Ä–æ–∫–∞ 530):
```typescript
const executorStatuses = ['PAID', 'NEW_PLANNED', 'UNDER_REVIEW', ...];
```

–≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ `NEW_PLANNED` - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å, –Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ.

---

### 3. –ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Order ‚Üî Invoice –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–∞—Ö

**–°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–±–ª–µ–º—ã**:
1. Order —Å–æ–∑–¥–∞–Ω —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DRAFT`
2. Invoice —Å–æ–∑–¥–∞–Ω —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DRAFT`
3. Invoice –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `SENT`
4. Order –≤—Å–µ –µ—â–µ `DRAFT`
5. Invoice –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `PAID`
6. Order –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å `NEW_PLANNED`, –Ω–æ –ø–µ—Ä–µ—Ö–æ–¥ `DRAFT` ‚Üí `NEW_PLANNED` –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω

**–ö–æ–¥** (`lib/validation/status-transitions.ts`):
```typescript
order: {
  'DRAFT': ['SENT', 'CANCELLED'],  // ‚ö†Ô∏è –ù–µ—Ç NEW_PLANNED
}
```

---

## üîç –ü—Ä–æ–±–ª–µ–º—ã –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ 3+ —Ñ–∞–π–ª–∞—Ö.

**–§–∞–π–ª—ã**:
- `app/api/orders/route.ts`
- `app/api/documents/create/route.ts`
- `app/api/documents/create-batch/route.ts`

**–†–∏—Å–∫**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞.

---

### 2. –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:
- `orders/route.ts`: `take: 20` (—Å—Ç—Ä–æ–∫–∞ 194)
- `documents/create/route.ts`: `take: 10` (—Å—Ç—Ä–æ–∫–∞ 364)

**–í–æ–ø—Ä–æ—Å**: –ü–æ—á–µ–º—É —Ä–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã? –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –Ω–æ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω –≤ –¥—Ä—É–≥–æ–º.

---

### 3. –†–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ cart_session_id

**–ü—Ä–æ–±–ª–µ–º–∞**: –í `orders/route.ts` –ø–æ–∏—Å–∫ —Å–Ω–∞—á–∞–ª–∞ –ø–æ `cart_session_id`, –∑–∞—Ç–µ–º –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É. –í `documents/create/route.ts` –ø–æ–∏—Å–∫ –≤—Å–µ–≥–¥–∞ –ø–æ –æ–±–æ–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–ö–æ–¥** (`app/api/orders/route.ts`, —Å—Ç—Ä–æ–∫–∞ 153-179):
```typescript
if (cartSessionId) {
  // –≠—Ç–∞–ø 1: –ü–æ–∏—Å–∫ –ø–æ cart_session_id
  existingOrder = await findExistingOrder(...);
}
if (!existingOrder) {
  // –≠—Ç–∞–ø 2: –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
  existingOrder = await findExistingOrder(...);
}
```

**–ö–æ–¥** (`app/api/documents/create/route.ts`, —Å—Ç—Ä–æ–∫–∞ 330-338):
```typescript
// –í—Å–µ–≥–¥–∞ –∏—â–µ–º –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
let existingQuote = await prisma.quote.findFirst({
  where: {
    parent_document_id: parentDocumentId,
    cart_session_id: cartSessionId,  // ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å null
    client_id: clientId,
    total_amount: totalAmount
  }
});
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ `cart_session_id` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –ø–æ–∏—Å–∫ –≤ `documents/create/route.ts` –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –±—ã –Ω–∞–π–¥–µ–Ω –≤ `orders/route.ts`.

---

## üîê –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### 1. –ù–µ–ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —É—Å–ª–æ–≤–∏—è.

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 57):
```typescript
if (userRole && !canUserChangeStatus(userRole as any, 'order', order.status)) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
}
```

**–ù–æ** (`lib/auth/permissions.ts`, —Å—Ç—Ä–æ–∫–∞ 148-158):
```typescript
if (roleStr === 'complectator') {
  const executorStatuses = ['NEW_PLANNED', 'UNDER_REVIEW', ...];
  if (documentStatus && executorStatuses.includes(documentStatus)) {
    return false;  // ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¢–ï–ö–£–©–ò–ô —Å—Ç–∞—Ç—É—Å, –∞ –Ω–µ –ù–û–í–´–ô
  }
  return true;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –§—É–Ω–∫—Ü–∏—è `canUserChangeStatus` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å.

---

### 2. –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∞–≤ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞ –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ PAID ‚Üí UNDER_REVIEW

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ `PAID` ‚Üí `UNDER_REVIEW`.

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 59):
```typescript
if (userRole === 'complectator' && ['NEW_PLANNED', 'UNDER_REVIEW', ...].includes(order.status)) {
  return NextResponse.json({ error: '–ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞' });
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–∏—Ç `PAID` ‚Üí `UNDER_REVIEW`, —Ç–æ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–µ –∏–∑–º–µ–Ω–∏—Ç—å Order —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `UNDER_REVIEW` –æ–Ω –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω —Å–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏–ª —ç—Ç–æ—Ç —Å—Ç–∞—Ç—É—Å.

---

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –≤—Å–µ API endpoints –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**–ü—Ä–∏–º–µ—Ä**: `app/api/orders/route.ts` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ `canUserCreateDocument`, —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω.

---

## üîÑ –ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 1. –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ü–∏–∫–ª–∞–º

**–ü—Ä–æ–±–ª–µ–º–∞**: Order —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç Invoice, Invoice —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç Order. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Ü–∏–∫–ª–∞–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ**: –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `skipSync` –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

---

### 2. –ù–µ–ø–æ–ª–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ Order ‚Üí Invoice –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Å–ª—É—á–∞–∏.

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 162-169):
```typescript
const statusMapping: Record<string, string> = {
  'NEW_PLANNED': 'DRAFT',
  'UNDER_REVIEW': 'DRAFT',
  'AWAITING_MEASUREMENT': 'SENT',
  'AWAITING_INVOICE': 'SENT',
  'COMPLETED': 'PAID',
  'CANCELLED': 'CANCELLED'
  // ‚ö†Ô∏è –ù–µ—Ç –º–∞–ø–ø–∏–Ω–≥–∞ –¥–ª—è DRAFT, SENT, PAID
};
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ Order –≤ —Å—Ç–∞—Ç—É—Å–µ `DRAFT` –∏–ª–∏ `SENT`, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è.

---

### 3. –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

**–ö–æ–¥** (`app/api/orders/[id]/status/route.ts`, —Å—Ç—Ä–æ–∫–∞ 173-179):
```typescript
await prisma.invoice.update({
  where: { id: order.invoice_id },
  data: {
    status: invoiceStatus,
    updated_at: new Date()
    // ‚ö†Ô∏è –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è notes, –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ DocumentHistory
  }
});
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã Order**
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –µ–¥–∏–Ω—É—é —Ü–µ–ø–æ—á–∫—É —Å—Ç–∞—Ç—É—Å–æ–≤
   - –û–±–Ω–æ–≤–∏—Ç—å –≤—Å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
   - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ—Ö–æ–¥–∞ DRAFT ‚Üí NEW_PLANNED**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ `DRAFT` ‚Üí `NEW_PLANNED` –≤ `STATUS_TRANSITIONS`
   - –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è Order (—Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—Ä–∞–∑—É `NEW_PLANNED`)

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞**
   - –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä—É –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å `PAID` ‚Üí `UNDER_REVIEW`
   - –ù–æ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∏–∑–º–µ–Ω—è—Ç—å `UNDER_REVIEW` –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
   - –ò–ª–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç `UNDER_REVIEW` ‚Üí `PAID` —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä—É

4. **–í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å**
   - –°–æ–∑–¥–∞—Ç—å `lib/documents/deduplication.ts`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—É—é –ª–æ–≥–∏–∫—É –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö

5. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π**
   - –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `_syncing` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

6. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã Invoice**
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `ORDERED` –∏–ª–∏ `IN_PRODUCTION`
   - –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

7. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å, –Ω–æ –∏ –Ω–æ–≤—ã–π
   - –£—á–∏—Ç—ã–≤–∞—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

8. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤**
   - –°–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ –≤ `DocumentHistory`
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

9. **–£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é project_file_url**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Order, –µ—Å–ª–∏ —Å—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `UNDER_REVIEW`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –£–ª—É—á—à–µ–Ω–∏—è

10. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤**
    - Unit-—Ç–µ—Å—Ç—ã –¥–ª—è `canTransitionTo`
    - Integration-—Ç–µ—Å—Ç—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

11. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π**
    - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

12. **–£–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
    - –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
    - –î–∏–∞–≥—Ä–∞–º–º—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤
    - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º

| –ü—Ä–æ–±–ª–µ–º–∞ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----------|-------------|----------------------|-----------|
| –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ Order | üî¥ –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è | 1 |
| –ü—Ä–æ–±–ª–µ–º–∞ DRAFT ‚Üí NEW_PLANNED | üî¥ –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | 1 |
| –ü—Ä–∞–≤–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞ | üî¥ –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è | 1 |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏ | üü° –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è | 2 |
| –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | üü° –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω—è—è | 1 |
| –ù–µ–ø–æ–ª–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ | üü° –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è | 2 |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | üü¢ –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–∞—è | 2 |

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã Order –≤–æ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –∏ –∫–æ–¥–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ DRAFT ‚Üí NEW_PLANNED –≤ STATUS_TRANSITIONS
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ UNDER_REVIEW
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ lib/documents/deduplication.ts
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ Order ‚Üí Invoice
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ DocumentHistory –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –µ–¥–∏–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é project_file_url –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Order

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-01-11  
**–ê–≤—Ç–æ—Ä –∞—É–¥–∏—Ç–∞**: AI Assistant  
**–°—Ç–∞—Ç—É—Å**: –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

