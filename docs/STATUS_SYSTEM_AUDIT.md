# üîç –ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–æ–≤

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-11-09  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** develop

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç—É—Å–æ–≤](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã-—Å—Ç–∞—Ç—É—Å–æ–≤)
2. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
3. [–ü—Ä–æ–±–ª–µ–º—ã —Å—Ä–µ–¥–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏](#–ø—Ä–æ–±–ª–µ–º—ã-—Å—Ä–µ–¥–Ω–µ–π-–≤–∞–∂–Ω–æ—Å—Ç–∏)
4. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-—É–ª—É—á—à–µ–Ω–∏—é)
5. [–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑](#–¥–µ—Ç–∞–ª—å–Ω—ã–π-–∞–Ω–∞–ª–∏–∑)

---

## üìä –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç—É—Å–æ–≤

### –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏

1. **Order (–ó–∞–∫–∞–∑)** - –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å—ã
2. **SupplierOrder (–ó–∞–∫–∞–∑ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)** - –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å—ã
3. **Invoice (–°—á–µ—Ç)** - –ù–ï –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤ (—Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `status` –≤ –ë–î, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è workflow)
4. **Quote (–ö–ü)** - –ù–ï –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤ (—Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `status` –≤ –ë–î, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è workflow)

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

#### Order Status
```typescript
'DRAFT' | 'SENT' | 'PAID' | 'NEW_PLANNED' | 'UNDER_REVIEW' | 
'AWAITING_MEASUREMENT' | 'AWAITING_INVOICE' | 'COMPLETED' | 'CANCELLED'
```

#### SupplierOrder Status (–≤ —Ç–∏–ø–∞—Ö)
```typescript
'DRAFT' | 'SENT' | 'CONFIRMED' | 'IN_PROGRESS' | 'COMPLETED' | 'CANCELLED'
```

#### SupplierOrder Status (–≤ STATUS_TRANSITIONS)
```typescript
'PENDING' | 'ORDERED' | 'RECEIVED_FROM_SUPPLIER' | 'COMPLETED' | 'CANCELLED'
```

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï**: –¢–∏–ø—ã SupplierOrder –≤ `lib/types/documents.ts` –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –≤ `lib/validation/status-transitions.ts`!

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ SupplierOrder

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `lib/types/documents.ts` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å—Ç–∞—Ç—É—Å—ã: `'DRAFT' | 'SENT' | 'CONFIRMED' | 'IN_PROGRESS' | 'COMPLETED' | 'CANCELLED'`
- –í `lib/validation/status-transitions.ts` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞—Ç—É—Å—ã: `'PENDING' | 'ORDERED' | 'RECEIVED_FROM_SUPPLIER' | 'COMPLETED' | 'CANCELLED'`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- TypeScript –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
- –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ –≤ runtime

**–§–∞–π–ª—ã:**
- `lib/types/documents.ts` (—Å—Ç—Ä–æ–∫–∏ 17-23)
- `lib/validation/status-transitions.ts` (—Å—Ç—Ä–æ–∫–∏ 17-23)

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–∏–≤–µ—Å—Ç–∏ —Ç–∏–ø—ã –∫ –µ–¥–∏–Ω–æ–º—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∏–∑ `STATUS_TRANSITIONS` –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã.

---

### 2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ Order –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í —Ä–∞–∑–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –æ–ø–∏—Å–∞–Ω—ã —Ä–∞–∑–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ Order:

1. **`docs/SYSTEM_RULES_AND_PERMISSIONS.md`**:
   ```
   DRAFT ‚Üí CONFIRMED ‚Üí IN_PRODUCTION ‚Üí READY ‚Üí COMPLETED
   ```

2. **`docs/ORDER_STATUS_CHAIN.md`**:
   ```
   DRAFT ‚Üí SENT ‚Üí PAID ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED
   ```

3. **`docs/DOCUMENT_LOGIC_COMPLETE.md`**:
   ```
   NEW_PLANNED ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED
   ```

4. **–ö–æ–¥ (`lib/validation/status-transitions.ts`)**:
   ```
   DRAFT ‚Üí SENT ‚Üí PAID ‚Üí UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT ‚Üí AWAITING_INVOICE ‚Üí COMPLETED
   DRAFT ‚Üí NEW_PLANNED ‚Üí UNDER_REVIEW ‚Üí ...
   ```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ workflow
- –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–¥—É. –ö–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã.

---

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
–õ–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:

1. `lib/validation/status-transitions.ts` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
2. `app/api/applications/[id]/route.ts` (—Å—Ç—Ä–æ–∫–∏ 166-172) - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
3. `app/api/applications/[id]/status/route.ts` (—Å—Ç—Ä–æ–∫–∏ 36-42) - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –æ—à–∏–±–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `canTransitionTo` –∏–∑ `lib/validation/status-transitions.ts` –≤–µ–∑–¥–µ.

---

### 4. DEPRECATED endpoints –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
–°—É—â–µ—Å—Ç–≤—É—é—Ç DEPRECATED endpoints, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

1. `app/api/applications/[id]/status/route.ts` - –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED, –Ω–æ –∫–æ–¥ –∞–∫—Ç–∏–≤–µ–Ω
2. `app/api/applications/[id]/route.ts` - —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ endpoint
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
–£–¥–∞–ª–∏—Ç—å DEPRECATED endpoints –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ:
- `/api/orders/[id]/status` - –¥–ª—è Order
- `/api/supplier-orders/[id]/status` - –¥–ª—è SupplierOrder
- `/api/documents/[id]/status` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π endpoint

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å—Ä–µ–¥–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏

### 5. –ù–µ–ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í `lib/auth/permissions.ts` —Ñ—É–Ω–∫—Ü–∏—è `canUserChangeStatus` –∏–º–µ–µ—Ç —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Å–ª—É—á–∞–∏:

```typescript
// –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ PAID ‚Üí UNDER_REVIEW
if (currentStatus === 'PAID' && newStatus === 'UNDER_REVIEW') {
  return true;
}
```

–ù–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –º–æ–∂–µ—Ç –ª–∏ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ `DRAFT ‚Üí SENT` –∏–ª–∏ `SENT ‚Üí PAID`.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –í–æ–∑–º–æ–∂–Ω—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è/–∑–∞–ø—Ä–µ—Ç—ã
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
–£–ø—Ä–æ—Å—Ç–∏—Ç—å –∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤.

---

### 6. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
–¢–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ `UNDER_REVIEW` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ `project_file_url`. –î–ª—è –¥—Ä—É–≥–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π.

**–ü—Ä–∏–º–µ—Ä:**
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ `AWAITING_MEASUREMENT` –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `measurement_done`
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ `COMPLETED` –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤.

---

### 7. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
–î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è `PAID` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ `NEW_PLANNED`, –Ω–æ –≤ –ë–î –æ—Å—Ç–∞–µ—Ç—Å—è `PAID`. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—É—Ç–∞–Ω–∏—Ü–µ.

**–§–∞–π–ª—ã:**
- `lib/utils/order-status-display.ts` (—Å—Ç—Ä–æ–∫–∏ 15-19)
- `lib/utils/order-status-display.ts` (—Å—Ç—Ä–æ–∫–∏ 41-46)

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ
- –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∏–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –æ—Ç –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é.

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ SupplierOrder

**–î–µ–π—Å—Ç–≤–∏–µ:**
–û–±–Ω–æ–≤–∏—Ç—å `lib/types/documents.ts`:

```typescript
export type SupplierOrderStatus = 
  | 'PENDING'
  | 'ORDERED'
  | 'RECEIVED_FROM_SUPPLIER'
  | 'COMPLETED'
  | 'CANCELLED';
```

### 2. –£–¥–∞–ª–µ–Ω–∏–µ DEPRECATED endpoints

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –£–¥–∞–ª–∏—Ç—å `app/api/applications/[id]/status/route.ts`
2. –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ `app/api/applications/[id]/route.ts`
3. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö endpoints

### 3. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é –ª–æ–≥–∏–∫—É –∏–∑ `app/api/applications/[id]/route.ts`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `canTransitionTo` –∏–∑ `lib/validation/status-transitions.ts`

### 4. –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–î–µ–π—Å—Ç–≤–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤:

```typescript
const STATUS_CHANGE_PERMISSIONS = {
  order: {
    'DRAFT ‚Üí SENT': ['ADMIN', 'COMPLECTATOR'],
    'SENT ‚Üí PAID': ['ADMIN', 'COMPLECTATOR'],
    'PAID ‚Üí UNDER_REVIEW': ['ADMIN', 'COMPLECTATOR'],
    'UNDER_REVIEW ‚Üí AWAITING_MEASUREMENT': ['ADMIN', 'EXECUTOR'],
    // ...
  }
};
```

### 5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

**–î–µ–π—Å—Ç–≤–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å—Ç–∞—Ç—É—Å–∞:

```typescript
export function validateStatusTransitionRequirements(
  documentType: string,
  currentStatus: string,
  newStatus: string,
  document: any
): { valid: boolean; error?: string } {
  // –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
}
```

---

## üìù –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### API Endpoints –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–æ–≤

#### –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ endpoints

1. **`PUT /api/orders/[id]/status`** ‚úÖ
   - –§–∞–π–ª: `app/api/orders/[id]/status/route.ts`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç: `canTransitionTo`, `canUserChangeStatus`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: —á–µ—Ä–µ–∑ Zod schema
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

2. **`PUT /api/supplier-orders/[id]/status`** ‚úÖ
   - –§–∞–π–ª: `app/api/supplier-orders/[id]/status/route.ts`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç: `canTransitionTo`, `canUserChangeStatus`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: —á–µ—Ä–µ–∑ Zod schema
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

3. **`PATCH /api/documents/[id]/status`** ‚úÖ
   - –§–∞–π–ª: `app/api/documents/[id]/status/route.ts`
   - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π endpoint –¥–ª—è Order –∏ SupplierOrder
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç: `canTransitionTo`, `canUserChangeStatus`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: —á–µ—Ä–µ–∑ Zod schema
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

#### DEPRECATED endpoints

1. **`PUT /api/applications/[id]/status`** ‚ö†Ô∏è DEPRECATED
   - –§–∞–π–ª: `app/api/applications/[id]/status/route.ts`
   - –ü–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED, –Ω–æ –∫–æ–¥ –∞–∫—Ç–∏–≤–µ–Ω
   - –î—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å `/api/orders/[id]/status`

2. **`PUT /api/applications/[id]`** ‚ö†Ô∏è –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å
   - –§–∞–π–ª: `app/api/applications/[id]/route.ts`
   - –ò–º–µ–µ—Ç –ª–æ–≥–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ (—Å—Ç—Ä–æ–∫–∏ 156-181)
   - –î—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å `/api/orders/[id]/status`

### –ú–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤

#### Order

| –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å | –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã | –ö—Ç–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å |
|----------------|---------------------|-------------------|
| DRAFT | SENT, NEW_PLANNED, CANCELLED | ADMIN, COMPLECTATOR |
| SENT | PAID, CANCELLED | ADMIN, COMPLECTATOR |
| PAID | UNDER_REVIEW, CANCELLED | ADMIN, COMPLECTATOR |
| NEW_PLANNED | UNDER_REVIEW, CANCELLED | ADMIN, EXECUTOR |
| UNDER_REVIEW | AWAITING_MEASUREMENT, AWAITING_INVOICE, CANCELLED | ADMIN, EXECUTOR |
| AWAITING_MEASUREMENT | AWAITING_INVOICE, CANCELLED | ADMIN, EXECUTOR |
| AWAITING_INVOICE | COMPLETED, CANCELLED | ADMIN, EXECUTOR |
| COMPLETED | - | - |
| CANCELLED | - | - |

#### SupplierOrder

| –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å | –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã | –ö—Ç–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å |
|----------------|---------------------|-------------------|
| PENDING | ORDERED, CANCELLED | ADMIN, EXECUTOR |
| ORDERED | RECEIVED_FROM_SUPPLIER, CANCELLED | ADMIN, EXECUTOR |
| RECEIVED_FROM_SUPPLIER | COMPLETED, CANCELLED | ADMIN, EXECUTOR |
| COMPLETED | - | - |
| CANCELLED | - | - |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–§—É–Ω–∫—Ü–∏—è `canUserChangeStatus` –≤ `lib/auth/permissions.ts`:

```typescript
// –î–ª—è Order
if (roleStr === 'complectator') {
  // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ DRAFT, SENT, PAID
  // –ú–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ PAID ‚Üí UNDER_REVIEW
  // –ù–æ –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏
2. –ù–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —è–≤–Ω–æ
3. –°–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ–∑–¥–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ SupplierOrder –≤ —Ç–∏–ø–∞—Ö
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤ Order
- [ ] –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- [ ] –£–¥–∞–ª–∏—Ç—å DEPRECATED endpoints
- [ ] –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è API endpoints

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç—É—Å–æ–≤

1. `lib/validation/status-transitions.ts` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤
2. `lib/auth/permissions.ts` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
3. `lib/utils/document-statuses.ts` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è UI
4. `lib/utils/status-mapping.ts` - –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤
5. `lib/utils/order-status-display.ts` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ Order
6. `lib/types/documents.ts` - TypeScript —Ç–∏–ø—ã —Å—Ç–∞—Ç—É—Å–æ–≤

### API Endpoints

1. `app/api/orders/[id]/status/route.ts` - —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ Order
2. `app/api/supplier-orders/[id]/status/route.ts` - —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ SupplierOrder
3. `app/api/documents/[id]/status/route.ts` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π endpoint
4. `app/api/applications/[id]/status/route.ts` - DEPRECATED
5. `app/api/applications/[id]/route.ts` - –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å (DEPRECATED?)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. `docs/SYSTEM_RULES_AND_PERMISSIONS.md` - –ø—Ä–∞–≤–∏–ª–∞ —Å–∏—Å—Ç–µ–º—ã
2. `docs/ORDER_STATUS_CHAIN.md` - —Ü–µ–ø–æ—á–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ Order
3. `docs/DOCUMENT_LOGIC_COMPLETE.md` - –ª–æ–≥–∏–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. `docs/AUDIT_LOGIC_COMPLETE.md` - –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞—É–¥–∏—Ç

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã)

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ SupplierOrder
2. ‚úÖ –£–¥–∞–ª–∏—Ç—å DEPRECATED endpoints
3. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

4. –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
5. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
6. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

7. –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
8. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
9. –°–æ–∑–¥–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞ –∞—É–¥–∏—Ç–∞**

