# üîÑ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

## üìã –¶–µ–ø–æ—á–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:

```
–ö–ü (Quote) 
  ‚Üì parent_document_id
–°—á–µ—Ç (Invoice) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ö–ü)
  ‚Üì parent_document_id  
–ó–∞–∫–∞–∑ (Order) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ö–ü –∏–ª–∏ –°—á–µ—Ç)
  ‚Üì parent_document_id
–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ (SupplierOrder) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ó–∞–∫–∞–∑)
```

## üéØ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Å–≤—è–∑–µ–π:

### 1. Quote (–ö–ü) - –ò—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
- `id: string` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
- `parent_document_id: null` (–∏—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç)
- `cart_session_id: string` (—Å–µ—Å—Å–∏—è –∫–æ—Ä–∑–∏–Ω—ã –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)
- `client_id: string`
- **–°–≤—è–∑–∏:** ‚Üí Invoice, Order, SupplierOrder (—á–µ—Ä–µ–∑ parent_document_id)

### 2. Invoice (–°—á–µ—Ç) - –ù–∞ –æ—Å–Ω–æ–≤–µ –ö–ü
- `id: string` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
- `parent_document_id: string` (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ö–ü)
- `cart_session_id: string` (—Ç–∞ –∂–µ —Å–µ—Å—Å–∏—è –∫–æ—Ä–∑–∏–Ω—ã)
- `client_id: string`
- **–°–≤—è–∑–∏:** ‚Üê Quote, ‚Üí Order, SupplierOrder (—á–µ—Ä–µ–∑ parent_document_id)

### 3. Order (–ó–∞–∫–∞–∑) - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç
- `id: string` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
- `parent_document_id: string` (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ö–ü –∏–ª–∏ –°—á–µ—Ç)
- `cart_session_id: string` (—Ç–∞ –∂–µ —Å–µ—Å—Å–∏—è –∫–æ—Ä–∑–∏–Ω—ã)
- `client_id: string`
- **–°–≤—è–∑–∏:** ‚Üê Quote/Invoice, ‚Üí SupplierOrder (—á–µ—Ä–µ–∑ parent_document_id)

### 4. SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- `id: string` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
- `parent_document_id: string` (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ó–∞–∫–∞–∑)
- `cart_session_id: string` (—Ç–∞ –∂–µ —Å–µ—Å—Å–∏—è –∫–æ—Ä–∑–∏–Ω—ã)
- `executor_id: string`
- **–°–≤—è–∑–∏:** ‚Üê Order (—á–µ—Ä–µ–∑ parent_document_id)

## üîó –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏:

### ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å:
- –û–¥–Ω–æ –ø–æ–ª–µ `parent_document_id` –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–≤—è–∑–µ–π
- `cart_session_id` –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏
- –ü—Ä–æ—Å—Ç–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å:
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç –±–µ–∑ –ö–ü (–ø—Ä—è–º–æ–π –∑–∞–∫–∞–∑)
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –±–µ–∑ —Å—á–µ—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:
- –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–ª—è–º: `parent_document_id`, `cart_session_id`, `client_id`, `total_amount`, `cart_data`
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## üöÄ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞
1. **–ö–ü** (parent_document_id: null, cart_session_id: "session_123")
2. **–°—á–µ—Ç** (parent_document_id: "quote_id", cart_session_id: "session_123")
3. **–ó–∞–∫–∞–∑** (parent_document_id: "quote_id", cart_session_id: "session_123")
4. **–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞** (parent_document_id: "order_id", cart_session_id: "session_123")

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä—è–º–æ–π –∑–∞–∫–∞–∑
1. **–°—á–µ—Ç** (parent_document_id: null, cart_session_id: "session_456")
2. **–ó–∞–∫–∞–∑** (parent_document_id: "invoice_id", cart_session_id: "session_456")
3. **–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞** (parent_document_id: "order_id", cart_session_id: "session_456")

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞–∫–∞–∑ –±–µ–∑ —Å—á–µ—Ç–∞
1. **–ö–ü** (parent_document_id: null, cart_session_id: "session_789")
2. **–ó–∞–∫–∞–∑** (parent_document_id: "quote_id", cart_session_id: "session_789")
3. **–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞** (parent_document_id: "order_id", cart_session_id: "session_789")

## üìä API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–≤—è–∑—è–º–∏:

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞:
```
GET /api/documents/{id}/chain
```

### –ü–æ–ª—É—á–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
```
GET /api/documents/{id}/related?type=all|quote|invoice|order|supplier_order
```

### –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–≤—è–∑—è–º–∏:
```
POST /api/documents/create
{
  "type": "invoice",
  "parent_document_id": "quote_id",
  "cart_session_id": "session_123",
  "client_id": "client_id",
  "items": [...]
}
```

## üîç –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

### –°—Ç—Ä–æ–≥–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:
1. **parent_document_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è null)
2. **cart_session_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è null)
3. **client_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
4. **total_amount** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
5. **cart_data** - —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ö–µ—à —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

### –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ö–µ—à —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã (`createContentHash`)
2. –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
3. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç
4. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
