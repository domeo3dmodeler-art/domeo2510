# üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Kubernetes Production

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –≥–¥–µ –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä—É –∏ Container Registry Yandex Cloud.

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞

1. **JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞** (`YC_SA_KEY` –∏–ª–∏ `YC_SA_JSON`)
   - –ù—É–∂–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Yandex Cloud
   - –¢—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–∞–≤–∞:
     - Container Registry (—á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –æ–±—Ä–∞–∑–æ–≤)
     - Kubernetes –∫–ª–∞—Å—Ç–µ—Ä (–¥–æ—Å—Ç—É–ø –∫ namespace `prod`)

2. **ID –∫–ª–∞—Å—Ç–µ—Ä–∞** (`CLUSTER_ID`)
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `cat9eenl393qj44riti4`

3. **ID —Ä–µ–µ—Å—Ç—Ä–∞** (`REGISTRY_ID`)
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `crpuein3jvjccnafs2vc`
   - –ü–æ–ª–Ω—ã–π –ø—É—Ç—å: `cr.yandex/crpuein3jvjccnafs2vc/app`

## üîç –ì–¥–µ –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ

### 1. GitHub Secrets (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CI/CD)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é GitHub:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Settings` ‚Üí `Secrets and variables` ‚Üí `Actions`
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã:
   - `YC_SA_KEY` - JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
   - `YC_CLOUD_ID` - ID –æ–±–ª–∞–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `YC_FOLDER_ID` - ID –∫–∞—Ç–∞–ª–æ–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `IMAGE_REPO` - –ü—É—Ç—å –∫ —Ä–µ–µ—Å—Ç—Ä—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**‚ö†Ô∏è –í–∞–∂–Ω–æ**: –ù–µ –∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

### 2. Yandex Cloud Console

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á:

1. –ó–∞–π–¥–∏—Ç–µ –≤ [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **IAM** ‚Üí **–°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã**
3. –ù–∞–π–¥–∏—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å –∏–º–µ–Ω–µ–º, —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å –ø—Ä–æ–µ–∫—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `domeo-k8s-sa`)
4. –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π:
   - **–°–æ–∑–¥–∞—Ç—å** ‚Üí **–°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç**
   - –ò–º—è: `domeo-k8s-access`
   - –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª–∏:
     - `container-registry.images.pusher`
     - `k8s.clusters.agent`
     - `k8s.editor`
5. –°–æ–∑–¥–∞–π—Ç–µ JSON –∫–ª—é—á:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
   - –í–∫–ª–∞–¥–∫–∞ **–ö–ª—é—á–∏** ‚Üí **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á** ‚Üí **JSON**
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ

### 3. Kubernetes –∫–ª–∞—Å—Ç–µ—Ä

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–µ:

- **ID –∫–ª–∞—Å—Ç–µ—Ä–∞**: `cat9eenl393qj44riti4`
- **Namespace**: `prod`
- **–í–Ω–µ—à–Ω–∏–π IP**: `158.160.202.117`
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: `yc-domeo-prod` –∏–ª–∏ `yc-default`

### 4. Container Registry

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–µ—Å—Ç—Ä–µ:

- **ID —Ä–µ–µ—Å—Ç—Ä–∞**: `crpuein3jvjccnafs2vc`
- **–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –æ–±—Ä–∞–∑–∞**: `cr.yandex/crpuein3jvjccnafs2vc/app`
- **–¢–µ–∫—É—â–∏–π —Ç–µ–≥**: `v20251030202308`

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ —Ñ–∞–π–ª —Å –∫–ª—é—á–æ–º

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ JSON –∫–ª—é—á –≤ —Ñ–∞–π–ª (–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!)
export YC_SERVICE_ACCOUNT_KEY_FILE="/path/to/sa.json"

# –ò–ª–∏ –≤ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (—Å–∫—Ä—ã—Ç—ã–π —Ñ–∞–π–ª)
export YC_SERVICE_ACCOUNT_KEY_FILE="$HOME/.yc/sa-key.json"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º JSON (–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ!)
export YC_SA_KEY='{"service_account_id":"...","id":"...","private_key":"..."}'

# –ò–ª–∏
export YC_SA_JSON='{"service_account_id":"...","id":"...","private_key":"..."}'
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ `.env` —Ñ–∞–π–ª (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` (—É–∂–µ –≤ `.gitignore`):

```bash
# .env.local (–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ!)
YC_SERVICE_ACCOUNT_KEY_FILE=/path/to/sa.json
YC_CLOUD_ID=your-cloud-id
YC_FOLDER_ID=your-folder-id
```

–ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# Linux/Mac
source .env.local

# Windows PowerShell
Get-Content .env.local | ForEach-Object { if ($_ -match '^([^=]+)=(.*)$') { [Environment]::SetEnvironmentVariable($matches[1], $matches[2]) } }
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û**: 

1. **–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
2. **–ù–ï –¥–µ–ª–∏—Ç–µ—Å—å –∫–ª—é—á–∞–º–∏ –ø—É–±–ª–∏—á–Ω–æ**
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.gitignore`** –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Å –∫–ª—é—á–∞–º–∏:
   ```
   .env.local
   *.key.json
   sa-key.json
   ~/.yc/sa-key.json
   ```
4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –∫ —Ñ–∞–π–ª–∞–º —Å –∫–ª—é—á–∞–º–∏:
   ```bash
   chmod 600 /path/to/sa.json
   ```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ YC
export YC_SERVICE_ACCOUNT_KEY_FILE="/path/to/sa.json"
yc iam create-token

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Container Registry
yc iam create-token | docker login cr.yandex -u iam --password-stdin
docker pull cr.yandex/crpuein3jvjccnafs2vc/app:v20251030202308

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É
yc managed-kubernetes cluster get-credentials --id cat9eenl393qj44riti4 --external --force
kubectl config use-context yc-domeo-prod
kubectl config set-context --current --namespace=prod
kubectl -n prod get nodes
```

## üÜò –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:

1. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –ø—Ä–æ–µ–∫—Ç–∞** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:
   - JSON –∫–ª—é—á–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
   - –ò–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞ —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
   - –î–æ—Å—Ç—É–ø –∫ Yandex Cloud Console
   - –î–æ—Å—Ç—É–ø –∫ IAM –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–∞–º
   - –î–æ—Å—Ç—É–ø –∫ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä—É

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Secrets** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CI/CD):
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –¥–æ—Å—Ç—É–ø–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-10-31

