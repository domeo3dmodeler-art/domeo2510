# üìã –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

## üéØ –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–í —Å–∏—Å—Ç–µ–º–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç **4 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**:

### 1. Order (–ó–∞–∫–∞–∑) - **–û–°–ù–û–í–ù–û–ô –î–û–ö–£–ú–ï–ù–¢** ‚≠ê
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `–ó–∞–∫–∞–∑-{XXX}` - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–ó–∞–∫–∞–∑-1`, `–ó–∞–∫–∞–∑-2`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: –ö–æ—Ä–∑–∏–Ω—ã (–∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑") –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–æ–º
- **–°–≤—è–∑—å**: `invoice_id` - –æ–¥–∏–Ω —Å—á–µ—Ç –Ω–∞ –æ–¥–∏–Ω –∑–∞–∫–∞–∑
- **–ú–æ–¥–µ–ª—å**: `orders` (Prisma)

### 2. Invoice (–°—á–µ—Ç)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –∫–ª–∏–µ–Ω—Ç—É
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `–°—á–µ—Ç-{timestamp}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–°—á–µ—Ç-1701234567890`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: Order (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–∫–∞–∑–∞)
- **–°–≤—è–∑—å**: `order_id` - –æ–¥–∏–Ω —Å—á–µ—Ç –Ω–∞ –æ–¥–∏–Ω –∑–∞–∫–∞–∑
- **–ú–æ–¥–µ–ª—å**: `invoices` (Prisma)

### 3. Quote (–ö–ü - –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–µ—Ä–≤–∏—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `–ö–ü-{timestamp}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–ö–ü-1701234567890`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: Order (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–∫–∞–∑–∞) –∏–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- **–ú–æ–¥–µ–ª—å**: `quotes` (Prisma)

### 4. SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–∫–∞–∑ —Ç–æ–≤–∞—Ä–æ–≤ —É –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–∞
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `SUPPLIER-{order_number}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SUPPLIER-–ó–∞–∫–∞–∑-123`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: Order (—Ç—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Order)
- **–ú–æ–¥–µ–ª—å**: `supplier_orders` (Prisma)

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–≤—è–∑–µ–π

–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –¥–≤–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –ø–æ–ª—è:

#### 1. `parent_document_id` (String?)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ü–µ–ø–æ—á–∫–µ
- **–ó–Ω–∞—á–µ–Ω–∏—è**:
  - `null` - –∏—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–Ω–µ —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–æ–≥–æ)
  - `"order_id"` - —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ó–∞–∫–∞–∑–∞ (–¥–ª—è Invoice, Quote, SupplierOrder)

#### 2. `cart_session_id` (String?)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: `generateCartSessionId()` –∏–∑ `lib/utils/cart-session.ts`

### –¶–µ–ø–æ—á–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê)

```
–ó–∞–∫–∞–∑ (Order) - –û–°–ù–û–í–ù–û–ô –î–û–ö–£–ú–ï–ù–¢
  ‚Üì parent_document_id = orderId
–°—á–µ—Ç (Invoice) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ó–∞–∫–∞–∑)
  ‚Üì order_id (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å one-to-one)
–ó–∞–∫–∞–∑ (Order) ‚Üî Invoice.order_id (–≤–∑–∞–∏–º–Ω–∞—è —Å–≤—è–∑—å)

–ó–∞–∫–∞–∑ (Order)
  ‚Üì parent_document_id = orderId
–ö–ü (Quote) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ó–∞–∫–∞–∑)

–ó–∞–∫–∞–∑ (Order)
  ‚Üì parent_document_id = orderId
–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ (SupplierOrder) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ó–∞–∫–∞–∑)
```

**–í–∞–∂–Ω–æ:** 
- Order —Å–æ–∑–¥–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–æ–º
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–≤—è–∑–∞–Ω—ã —Å Order —á–µ—Ä–µ–∑ `parent_document_id`
- Invoice —Ç–∞–∫–∂–µ —Å–≤—è–∑–∞–Ω —Å Order —á–µ—Ä–µ–∑ `order_id` (one-to-one —Å–≤—è–∑—å)
- –£ –æ–¥–Ω–æ–≥–æ Order –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω Invoice

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏

#### Order ‚Üî Invoice (One-to-One)
- **Order.invoice_id** ‚Üí **Invoice.id** (–æ–¥–∏–Ω —Å—á–µ—Ç –Ω–∞ –∑–∞–∫–∞–∑)
- **Invoice.order_id** ‚Üí **Order.id** (—Å—á–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∑–∞–∫–∞–∑—É)
- **–í–∞–∂–Ω–æ**: Order —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã —á–µ—Ä–µ–∑ `/api/orders`, Invoice —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order —á–µ—Ä–µ–∑ `/api/documents/create` —Å —Ç–∏–ø–æ–º `'invoice'` –∏ `parent_document_id = orderId`

---

## üìä –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ —Å—Ç–∞—Ç—É—Å—ã

**–í–ê–ñ–ù–û**: –°—Ç–∞—Ç—É—Å—ã –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —É Order –∏ SupplierOrder. Invoice –∏ Quote –Ω–µ –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å–æ–≤.

### Order (–ó–∞–∫–∞–∑) - –°—Ç–∞—Ç—É—Å—ã

```
DRAFT (–ß–µ—Ä–Ω–æ–≤–∏–∫) - –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
  ‚Üì
  ‚îú‚îÄ‚Üí SENT (–°—á–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω)
  ‚îÇ     ‚Üì
  ‚îÇ     ‚îî‚îÄ‚Üí PAID (–°—á–µ—Ç –æ–ø–ª–∞—á–µ–Ω)
  ‚îÇ           ‚Üì
  ‚îÇ           ‚îú‚îÄ‚Üí UNDER_REVIEW (–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ) - —Ç—Ä–µ–±—É–µ—Ç project_file_url
  ‚îÇ           ‚îÇ     ‚Üì
  ‚îÇ           ‚îÇ     ‚îú‚îÄ‚Üí AWAITING_MEASUREMENT (–ñ–¥–µ—Ç –∑–∞–º–µ—Ä)
  ‚îÇ           ‚îÇ     ‚îÇ     ‚Üì
  ‚îÇ           ‚îÇ     ‚îÇ     ‚îî‚îÄ‚Üí AWAITING_INVOICE (–û–∂–∏–¥–∞–µ—Ç —Å—á–µ—Ç)
  ‚îÇ           ‚îÇ     ‚îÇ           ‚Üì
  ‚îÇ           ‚îÇ     ‚îÇ           ‚îî‚îÄ‚Üí COMPLETED (–í—ã–ø–æ–ª–Ω–µ–Ω)
  ‚îÇ           ‚îÇ     ‚îÇ
  ‚îÇ           ‚îÇ     ‚îî‚îÄ‚Üí AWAITING_INVOICE (–û–∂–∏–¥–∞–µ—Ç —Å—á–µ—Ç) - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å
  ‚îÇ           ‚îÇ           ‚Üì
  ‚îÇ           ‚îÇ           ‚îî‚îÄ‚Üí COMPLETED (–í—ã–ø–æ–ª–Ω–µ–Ω)
  ‚îÇ           ‚îÇ
  ‚îÇ           ‚îî‚îÄ‚Üí CANCELLED (–û—Ç–º–µ–Ω–µ–Ω)
  ‚îÇ
  ‚îú‚îÄ‚Üí NEW_PLANNED (–ù–æ–≤—ã–π –∑–∞–∫–∞–∑) - –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –∏–∑ DRAFT
  ‚îÇ     ‚Üì
  ‚îÇ     ‚îî‚îÄ‚Üí UNDER_REVIEW (–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ)
  ‚îÇ           ‚Üì
  ‚îÇ           ‚îî‚îÄ‚Üí ... (–¥–∞–ª–µ–µ –∫–∞–∫ –≤—ã—à–µ)
  ‚îÇ
  ‚îî‚îÄ‚Üí CANCELLED (–û—Ç–º–µ–Ω–µ–Ω)
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `DRAFT` - –ß–µ—Ä–Ω–æ–≤–∏–∫ (–Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏)
- `SENT` - –°—á–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω
- `PAID` - –°—á–µ—Ç –æ–ø–ª–∞—á–µ–Ω
- `NEW_PLANNED` - –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –≤–º–µ—Å—Ç–æ PAID)
- `UNDER_REVIEW` - –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞)
- `AWAITING_MEASUREMENT` - –û–∂–∏–¥–∞–µ—Ç –∑–∞–º–µ—Ä–∞
- `AWAITING_INVOICE` - –û–∂–∏–¥–∞–µ—Ç —Å—á–µ—Ç–∞
- `COMPLETED` - –í—ã–ø–æ–ª–Ω–µ–Ω
- `CANCELLED` - –û—Ç–º–µ–Ω–µ–Ω

**–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
- `DRAFT` ‚Üí `SENT`, `NEW_PLANNED`, `CANCELLED`: COMPLECTATOR, ADMIN
- `SENT` ‚Üí `PAID`, `CANCELLED`: COMPLECTATOR, ADMIN
- `PAID` ‚Üí `UNDER_REVIEW`, `CANCELLED`: COMPLECTATOR, EXECUTOR, ADMIN
- `NEW_PLANNED` ‚Üí `UNDER_REVIEW`, `CANCELLED`: EXECUTOR, ADMIN
- `UNDER_REVIEW` ‚Üí `AWAITING_MEASUREMENT`, `AWAITING_INVOICE`, `CANCELLED`: EXECUTOR, ADMIN (—Ç—Ä–µ–±—É–µ—Ç `project_file_url`)
- `AWAITING_MEASUREMENT` ‚Üí `AWAITING_INVOICE`, `CANCELLED`: EXECUTOR, ADMIN
- `AWAITING_INVOICE` ‚Üí `COMPLETED`, `CANCELLED`: EXECUTOR, ADMIN

**–í–ê–ñ–ù–û**: Invoice –∏ Quote –Ω–µ –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å–æ–≤. –°—Ç–∞—Ç—É—Å—ã Order –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å Invoice.

### SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞) - –°—Ç–∞—Ç—É—Å—ã

```
PENDING (–í –æ–∂–∏–¥–∞–Ω–∏–∏) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  ‚Üì
ORDERED (–ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω)
  ‚Üì
RECEIVED_FROM_SUPPLIER (–ü–æ–ª—É—á–µ–Ω –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
  ‚Üì
COMPLETED (–í—ã–ø–æ–ª–Ω–µ–Ω)
  ‚Üì
CANCELLED (–û—Ç–º–µ–Ω–µ–Ω) - –∏–∑ –ª—é–±–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `PENDING` - –í –æ–∂–∏–¥–∞–Ω–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `ORDERED` - –ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω
- `RECEIVED_FROM_SUPPLIER` - –ü–æ–ª—É—á–µ–Ω –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `COMPLETED` - –í—ã–ø–æ–ª–Ω–µ–Ω
- `CANCELLED` - –û—Ç–º–µ–Ω–µ–Ω

**–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
- `PENDING` ‚Üí `ORDERED`: ADMIN, EXECUTOR
- `ORDERED` ‚Üí `RECEIVED_FROM_SUPPLIER`: ADMIN, EXECUTOR
- `RECEIVED_FROM_SUPPLIER` ‚Üí `COMPLETED`: ADMIN, EXECUTOR
- –õ—é–±–æ–π ‚Üí `CANCELLED`: ADMIN

---

## üõí –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã

#### Order (–ó–∞–∫–∞–∑) - –û–°–ù–û–í–ù–û–ô –î–û–ö–£–ú–ï–ù–¢ ‚≠ê
- **API**: `POST /api/orders`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 
  ```json
  {
    "client_id": "string",
    "items": [...],
    "total_amount": 0,
    "subtotal": 0,
    "tax_amount": 0,
    "notes": "string"
  }
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è **Order** —Å –Ω–æ–º–µ—Ä–æ–º `–ó–∞–∫–∞–∑-XXX`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Order —Å–æ–∑–¥–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–æ–º
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `cart_data` –∏ `total_amount` –¥–ª—è –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏
  - `parent_document_id` –≤—Å–µ–≥–¥–∞ `null` –¥–ª—è Order –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
  - –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `parent_document_id` (null), `cart_session_id`, `client_id`, `total_amount`, `cart_data`

#### Invoice (–°—á–µ—Ç) - –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **API**: `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'invoice'`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 
  ```json
  {
    "type": "invoice",
    "parent_document_id": "orderId",
    "client_id": "string",
    "items": [...],
    "total_amount": 0
  }
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è **Invoice** –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Invoice —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order —á–µ—Ä–µ–∑ `parent_document_id = orderId`
  - –¢–∞–∫–∂–µ —Å–≤—è–∑–∞–Ω —Å Order —á–µ—Ä–µ–∑ `order_id` (one-to-one —Å–≤—è–∑—å)
  - –£ –æ–¥–Ω–æ–≥–æ Order –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω Invoice
  - –ï—Å–ª–∏ Invoice —Å–æ–∑–¥–∞–Ω –¥–ª—è Order, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `Order.invoice_id`
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `parent_document_id` (orderId), `cart_session_id`, `client_id`, `total_amount`, `cart_data`

#### Quote (–ö–ü) - –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **API**: `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'quote'`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 
  ```json
  {
    "type": "quote",
    "parent_document_id": "orderId",
    "client_id": "string",
    "items": [...],
    "total_amount": 0
  }
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è **Quote** –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Quote —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order —á–µ—Ä–µ–∑ `parent_document_id = orderId`
  - –ï—Å–ª–∏ `parent_document_id` —É–∫–∞–∑–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ —ç—Ç–æ Order
  - –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ Quote –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –±–µ–∑ Order (`parent_document_id = null`), –Ω–æ —ç—Ç–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `parent_document_id` (orderId –∏–ª–∏ null), `cart_session_id`, `client_id`, `total_amount`, `cart_data`

#### SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞) - –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **API**: `POST /api/supplier-orders`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 
  ```json
  {
    "orderId": "string",
    "supplierName": "string",
    "supplierEmail": "string",
    "supplierPhone": "string",
    "expectedDate": "YYYY-MM-DD",
    "notes": "string",
    "cartData": { items: [...] }
  }
  ```
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –î–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å Order (–∏—Å—Ç–æ—á–Ω–∏–∫)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è SupplierOrder —Å –Ω–æ–º–µ—Ä–æ–º `SUPPLIER-{order_number}`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - SupplierOrder —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order —á–µ—Ä–µ–∑ `parent_document_id = orderId`
  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `invoiceId`, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–π Order
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `cart_data` –∏ `total_amount` –∏–∑ Order –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `parent_document_id` (orderId), `cart_session_id`, `cart_data`

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

#### Invoice –∏–∑ Order
- **API**: `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'invoice'`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ type: 'invoice', parent_document_id: orderId, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Invoice —Å `parent_document_id = orderId` –∏ `order_id = orderId`

#### Quote –∏–∑ Order
- **API**: `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'quote'`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ type: 'quote', parent_document_id: orderId, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Quote —Å `parent_document_id = orderId`

#### SupplierOrder –∏–∑ Order
- **API**: `POST /api/supplier-orders`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ orderId, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: SupplierOrder —Å `parent_document_id = orderId`

---

## üîç –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏

### –¶–µ–ª—å
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏:
- –ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∫–ª–∏–∫–∞—Ö –Ω–∞ –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∏–∑ –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã
- –°–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

–î–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:

1. **parent_document_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è `null`)
2. **cart_session_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è `null`)
3. **client_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
4. **total_amount** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–¥–æ–ø—É—Å–∫ ¬±0.01 –¥–ª—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è)
5. **cart_data** - –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã

### –î–ª—è Order

Order –∏–º–µ–µ—Ç –ø—Ä—è–º—ã–µ –ø–æ–ª—è `cart_data` –∏ `total_amount`:
1. **parent_document_id** - –≤—Å–µ–≥–¥–∞ `null` –¥–ª—è Order –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
2. **cart_session_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
3. **client_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
4. **total_amount** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—É–º–º—ã –Ω–∞–ø—Ä—è–º—É—é
5. **cart_data** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –Ω–∞–ø—Ä—è–º—É—é

### –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏

```typescript
async function findExistingDocument(
  type: 'quote' | 'invoice' | 'order' | 'supplier_order',
  parentDocumentId: string | null,
  cartSessionId: string | null,
  clientId: string,
  items: any[],
  totalAmount: number
): Promise<Document | null> {
  // –≠—Ç–∞–ø 1: –°—Ç—Ä–æ–≥–∏–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
  let existing = await prisma[type].findFirst({
    where: {
      parent_document_id: parentDocumentId,
      cart_session_id: cartSessionId,
      client_id: clientId,
      total_amount: totalAmount
    }
  });
  
  if (existing) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã
    if (compareCartContent(items, existing.cart_data)) {
      return existing; // –ù–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç
    }
  }
  
  // –≠—Ç–∞–ø 2: –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –∫–æ—Ä–∑–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ –∫–ª–∏–µ–Ω—Ç–∞)
  const candidates = await prisma[type].findMany({
    where: {
      client_id: clientId, // –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ –∫–ª–∏–µ–Ω—Ç–∞!
      parent_document_id: parentDocumentId,
      total_amount: {
        gte: totalAmount - 0.01,
        lte: totalAmount + 0.01
      }
    },
    orderBy: { created_at: 'desc' },
    take: 10
  });
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
  for (const candidate of candidates) {
    if (compareCartContent(items, candidate.cart_data)) {
      return candidate; // –ù–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
    }
  }
  
  return null; // –î—É–±–ª–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
}
```

### –§—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã

```typescript
function compareCartContent(items1: any[], items2String: string | null): boolean {
  if (!items2String) return false;
  
  try {
    const items2 = JSON.parse(items2String);
    const normalized1 = normalizeItems(items1);
    const normalized2 = normalizeItems(items2);
    
    if (normalized1.length !== normalized2.length) return false;
    
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ product_id, quantity, unitPrice
    const sorted1 = normalized1.sort((a, b) => a.productId.localeCompare(b.productId));
    const sorted2 = normalized2.sort((a, b) => a.productId.localeCompare(b.productId));
    
    return sorted1.every((item1, index) => {
      const item2 = sorted2[index];
      return (
        item1.productId === item2.productId &&
        item1.quantity === item2.quantity &&
        Math.abs(item1.unitPrice - item2.unitPrice) < 0.01
      );
    });
  } catch (error) {
    return false;
  }
}
```

---

## üë• –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. **ADMIN** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
2. **COMPLECTATOR** - –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
3. **EXECUTOR** - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∑–∞–∫–∞–∑–∞–º–∏

### –ü—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### Order (–ó–∞–∫–∞–∑) - –û–°–ù–û–í–ù–û–ô –î–û–ö–£–ú–ï–ù–¢
- **COMPLECTATOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (–∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑")
- **EXECUTOR**: ‚úÖ –í–∏–¥–µ—Ç—å –∑–∞–∫–∞–∑—ã, –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

#### Invoice (–°—á–µ—Ç)
- **COMPLECTATOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **EXECUTOR**: ‚ùå –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

#### Quote (–ö–ü)
- **COMPLECTATOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ Order –∏–ª–∏ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- **EXECUTOR**: ‚ùå –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

#### SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- **COMPLECTATOR**: ‚ùå –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å
- **EXECUTOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

### –ü—Ä–∞–≤–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

–°–º. —Ä–∞–∑–¥–µ–ª "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ —Å—Ç–∞—Ç—É—Å—ã" –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

---

## üì° API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### POST `/api/orders`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ Order (–æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞) –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "client_id": "string",
    "items": [...],
    "total_amount": 0,
    "subtotal": 0,
    "tax_amount": 0,
    "notes": "string"
  }
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
  ```json
  {
    "order": { id, number, status, ... }
  }
  ```
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Order —Å–æ–∑–¥–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `cart_data` –∏ `total_amount` –¥–ª—è –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏
  - `parent_document_id` –≤—Å–µ–≥–¥–∞ `null`
  - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Order –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å Invoice, Quote, SupplierOrder –Ω–∞ –µ–≥–æ –æ—Å–Ω–æ–≤–µ

#### POST `/api/orders/create-with-invoice` (DEPRECATED)
- **–°—Ç–∞—Ç—É—Å**: –£–°–¢–ê–†–ï–õ (–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–∞–Ω–µ–µ —Å–æ–∑–¥–∞–≤–∞–ª Order –∏ Invoice –≤–º–µ—Å—Ç–µ, —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–µ—Ç Order
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POST /api/orders` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Order, –∑–∞—Ç–µ–º `POST /api/documents/create` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Invoice

#### POST `/api/documents/create`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–µ–π
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç**: `quote`, `invoice`, `supplier_order`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "type": "quote|invoice|supplier_order",
    "client_id": "string",
    "items": [...],
    "total_amount": 0,
    "parent_document_id": "string|null",
    "cart_session_id": "string|null",
    "prevent_duplicates": true
  }
  ```
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –î–ª—è `invoice`: `parent_document_id` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `orderId`
  - –î–ª—è `quote`: `parent_document_id` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `orderId`
  - –î–ª—è `supplier_order`: `parent_document_id` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `orderId`

#### POST `/api/supplier-orders`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "orderId": "string",
    "supplierName": "string",
    "supplierEmail": "string",
    "supplierPhone": "string",
    "expectedDate": "YYYY-MM-DD",
    "notes": "string",
    "cartData": { items: [...] }
  }
  ```
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `orderId` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: `invoiceId` (–Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–π Order)
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `cart_data` –∏–∑ Order –µ—Å–ª–∏ `cartData` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω

#### POST `/api/cart/export/enhanced`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –≠–∫—Å–ø–æ—Ä—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (PDF/Excel)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç**: `quote`, `invoice`, `supplier_order`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "cart": { items: [...] },
    "documentType": "quote|invoice|supplier_order",
    "format": "pdf|excel|csv",
    "clientId": "string",
    "sourceDocumentId": "string",
    "sourceDocumentType": "string"
  }
  ```
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –ë–î –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POST /api/orders` –∏ `POST /api/documents/create`

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

#### PUT `/api/invoices/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "DRAFT|SENT|PAID|...", notes?: "string" }`
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Order –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice –£–î–ê–õ–ï–ù–û. Order –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∑–∞—Ä–∞–Ω–µ–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.

#### PUT `/api/orders/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "NEW_PLANNED|UNDER_REVIEW|...", require_measurement?: boolean }`

#### PUT `/api/quotes/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "DRAFT|SENT|ACCEPTED|..." }`

#### PUT `/api/supplier-orders/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "PENDING|ORDERED|..." }`

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### GET `/api/quotes` - –°–ø–∏—Å–æ–∫ –ö–ü
#### GET `/api/invoices` - –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
#### GET `/api/orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
#### GET `/api/supplier-orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞

---

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ö–æ—Ä–∑–∏–Ω–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### `EnhancedCartSidebar`
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `DocumentWorkflowIntegration`
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
  - –ö–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
    - **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"** ‚Üí —Å–æ–∑–¥–∞–µ—Ç Order —á–µ—Ä–µ–∑ `POST /api/orders`
    - "–ö–ü" ‚Üí —Å–æ–∑–¥–∞–µ—Ç Quote (–Ω–∞ –æ—Å–Ω–æ–≤–µ Order –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–ª–∏ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã)
    - "–°—á–µ—Ç" ‚Üí —Å–æ–∑–¥–∞–µ—Ç Invoice (–Ω–∞ –æ—Å–Ω–æ–≤–µ Order, –µ—Å–ª–∏ –µ—Å—Ç—å)
    - "–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞" ‚Üí —Å–æ–∑–¥–∞–µ—Ç SupplierOrder (—Ç—Ä–µ–±—É–µ—Ç Order)
  - –î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
  - –ö–æ—Ä–∑–∏–Ω–∞ –ù–ï –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Order

#### `QuickCartSidebar`
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–æ—Ä–∑–∏–Ω—ã
- **–§—É–Ω–∫—Ü–∏–∏**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `EnhancedCartSidebar`

#### `CartManager` (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/doors`)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/doors/page.tsx`
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä–∞ –¥–≤–µ—Ä–µ–π
  - –ö–Ω–æ–ø–∫–∞ **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"** ‚Üí —Å–æ–∑–¥–∞–µ—Ç Order —á–µ—Ä–µ–∑ `POST /api/orders`

### –î–∞—à–±–æ—Ä–¥—ã

#### –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä (`/complectator/dashboard`)
- **–í–∫–ª–∞–¥–∫–∏**: –ö–æ—Ä–∑–∏–Ω–∞, –î–æ–∫—É–º–µ–Ω—Ç—ã, –ó–∞–∫–∞–∑—ã
- **–í–∫–ª–∞–¥–∫–∞ "–ö–æ—Ä–∑–∏–Ω–∞"**: `DocumentWorkflowIntegration` —Å –∫–Ω–æ–ø–∫–æ–π "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"
- **–í–∫–ª–∞–¥–∫–∞ "–î–æ–∫—É–º–µ–Ω—Ç—ã"**: –ü—Ä–æ—Å–º–æ—Ç—Ä –ö–ü, –°—á–µ—Ç–æ–≤, –ó–∞–∫–∞–∑–æ–≤ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
- **–í–∫–ª–∞–¥–∫–∞ "–ó–∞–∫–∞–∑—ã"**: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —Å Invoice

#### –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (`/executor/dashboard`)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `OrdersBoard` - —Ç–∞–±–ª–æ –∑–∞–∫–∞–∑–æ–≤
- **–§—É–Ω–∫—Ü–∏–∏**: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üîÑ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ—Ç –∫–æ—Ä–∑–∏–Ω—ã –¥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ (–ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê)

1. **–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä** –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ù–∞–∂–∏–º–∞–µ—Ç **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Order** (`–ó–∞–∫–∞–∑-123`) —á–µ—Ä–µ–∑ `POST /api/orders`
   - Order —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `cart_data` –∏ `total_amount` –¥–ª—è –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏
   - `parent_document_id = null` (Order - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç)
3. –ù–∞ –æ—Å–Ω–æ–≤–µ Order —Å–æ–∑–¥–∞–µ—Ç **Invoice**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'invoice'` –∏ `parent_document_id = orderId`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Invoice** (`–°—á–µ—Ç-...`)
   - Invoice –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ Order —á–µ—Ä–µ–∑ `order_id` –∏ `invoice_id`
4. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å Invoice: `DRAFT` ‚Üí `SENT`
5. –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç: —Å—Ç–∞—Ç—É—Å Invoice ‚Üí `PAID`
6. **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å** —Å–æ–∑–¥–∞–µ—Ç **SupplierOrder** –Ω–∞ –æ—Å–Ω–æ–≤–µ Order
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `POST /api/supplier-orders` —Å `orderId`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è `SUPPLIER-–ó–∞–∫–∞–∑-123`
7. SupplierOrder –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å—ã: `PENDING` ‚Üí `ORDERED` ‚Üí `RECEIVED_FROM_SUPPLIER` ‚Üí `COMPLETED`
8. Order –∏ Invoice –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ –ö–ü (–û–ë–ù–û–í–õ–ï–ù–û)

1. **–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä** –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ù–∞–∂–∏–º–∞–µ—Ç **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Order** (`–ó–∞–∫–∞–∑-123`)
3. –ù–∞ –æ—Å–Ω–æ–≤–µ Order —Å–æ–∑–¥–∞–µ—Ç **Quote**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'quote'` –∏ `parent_document_id = orderId`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Quote** (`–ö–ü-...`)
4. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å Quote: `DRAFT` ‚Üí `SENT`
5. –ö–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç: Quote ‚Üí `ACCEPTED`
6. –ù–∞ –æ—Å–Ω–æ–≤–µ Order —Å–æ–∑–¥–∞–µ—Ç **Invoice**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'invoice'` –∏ `parent_document_id = orderId`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Invoice** (`–°—á–µ—Ç-...`)
7. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å Invoice: `DRAFT` ‚Üí `SENT`
8. –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç: Invoice ‚Üí `PAID`
9. –î–∞–ª—å—à–µ –∫–∞–∫ –≤ –°—Ü–µ–Ω–∞—Ä–∏–∏ 1

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä—è–º–æ–π –∑–∞–∫–∞–∑ (–±–µ–∑ –ö–ü) (–û–ë–ù–û–í–õ–ï–ù–û)

1. **–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä** –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ù–∞–∂–∏–º–∞–µ—Ç **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Order** (`–ó–∞–∫–∞–∑-123`)
   - `parent_document_id = null` (–ø—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã)
3. –ù–∞ –æ—Å–Ω–æ–≤–µ Order —Å–æ–∑–¥–∞–µ—Ç **Invoice**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `POST /api/documents/create` —Å —Ç–∏–ø–æ–º `'invoice'` –∏ `parent_document_id = orderId`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Invoice** (`–°—á–µ—Ç-...`)
4. –î–∞–ª—å—à–µ –∫–∞–∫ –≤ –°—Ü–µ–Ω–∞—Ä–∏–∏ 1

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"** –¥–≤–∞–∂–¥—ã –ø–æ–¥—Ä—è–¥
2. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–µ—Ç Order
3. –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –Ω–∞—Ö–æ–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Order —á–µ—Ä–µ–∑ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—é
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `parent_document_id` (null), `cart_session_id`, `client_id`, `total_amount`, `cart_data`
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Order, –¥—É–±–ª–∏–∫–∞—Ç –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

1. **–ö–ª–∏–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∫–∞ `client_id` –≤ –ë–î
2. **–ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞**: `items.length > 0`
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
4. **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
5. **Order –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å**: –î–ª—è Invoice, Quote, SupplierOrder –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ `parent_document_id` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Order (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

1. **–î–æ–∫—É–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
2. **–ü–µ—Ä–µ—Ö–æ–¥ —Ä–∞–∑—Ä–µ—à–µ–Ω**: –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `STATUS_TRANSITIONS`
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
4. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ `isStatusBlocked()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
5. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**: –ù–∞–ø—Ä–∏–º–µ—Ä, `project_file_url` –¥–ª—è `UNDER_REVIEW` –≤ Order

### –ê—É–¥–∏—Ç

- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `DocumentHistory`
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –≤ `DocumentComment`
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ `Notification` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Order - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç**: Order —Å–æ–∑–¥–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–æ–º. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (Invoice, Quote, SupplierOrder) —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Order —á–µ—Ä–µ–∑ `parent_document_id`.

2. **–û–¥–∏–Ω Invoice –Ω–∞ Order**: Order –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω Invoice (—á–µ—Ä–µ–∑ `invoice_id`), –∏ Invoice –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Order (—á–µ—Ä–µ–∑ `order_id`). –°–≤—è–∑—å one-to-one.

3. **–ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤**: –û–¥–∏–Ω Client –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ Orders, –Ω–æ –∫–∞–∂–¥—ã–π Order –∏–º–µ–µ—Ç —Å–≤–æ–π Invoice.

4. **SupplierOrder —Ç—Ä–µ–±—É–µ—Ç Order**: –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å SupplierOrder –±–µ–∑ Order. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `parent_document_id = orderId`.

5. **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤–µ—Ä–Ω–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç.

6. **–°—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è**: –î–ª—è COMPLECTATOR —Å—Ç–∞—Ç—É—Å—ã Order —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ Invoice; –¥–ª—è EXECUTOR –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã Order.

7. **–ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è**: –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Order –∫–æ—Ä–∑–∏–Ω–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ Invoice, Quote –∏ —Ç.–¥.).

8. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Order –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice –£–î–ê–õ–ï–ù–û**: Order –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∑–∞—Ä–∞–Ω–µ–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã. –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice (—Å—Ç–∞—Ç—É—Å `PAID`) Order —É–∂–µ –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å.

---

## üöÄ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–≤—è–∑—è–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
```
GET /api/documents/{id}/chain
```

### –ü–æ–ª—É—á–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```
GET /api/documents/{id}/related?type=all|quote|invoice|order|supplier_order
```

### –ü–æ–ª—É—á–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```
GET /api/documents/{id}/children
```

### –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç
```
GET /api/documents/{id}/parent
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-11-03  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-01-XX  
**–í–µ—Ä—Å–∏—è**: 2.0  
**–°—Ç–∞—Ç—É—Å**: –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–¥ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É: Order - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç)
