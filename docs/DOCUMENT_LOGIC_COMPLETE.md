# üìã –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

## üéØ –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–í —Å–∏—Å—Ç–µ–º–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç **4 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**:

### 1. Quote (–ö–ü - –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–µ—Ä–≤–∏—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `–ö–ü-{timestamp}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–ö–ü-1701234567890`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: –ö–æ—Ä–∑–∏–Ω—ã, –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã
- **–ú–æ–¥–µ–ª—å**: `quotes` (Prisma)

### 2. Invoice (–°—á–µ—Ç)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –∫–ª–∏–µ–Ω—Ç—É
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `–°—á–µ—Ç-{timestamp}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–°—á–µ—Ç-1701234567890`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: –ö–ü, –∫–æ—Ä–∑–∏–Ω—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ó–∞–∫–∞–∑–∞
- **–°–≤—è–∑—å**: `order_id` - –æ–¥–∏–Ω —Å—á–µ—Ç –Ω–∞ –æ–¥–∏–Ω –∑–∞–∫–∞–∑
- **–ú–æ–¥–µ–ª—å**: `invoices` (Prisma)

### 3. Order (–ó–∞–∫–∞–∑)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `–ó–∞–∫–∞–∑-{XXX}` - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–ó–∞–∫–∞–∑-1`, `–ó–∞–∫–∞–∑-2`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: –ö–æ—Ä–∑–∏–Ω—ã (–∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ —Å—á–µ—Ç–∞ (`PAID`)
- **–°–≤—è–∑—å**: `invoice_id` - –æ–¥–∏–Ω —Å—á–µ—Ç –Ω–∞ –æ–¥–∏–Ω –∑–∞–∫–∞–∑
- **–ú–æ–¥–µ–ª—å**: `orders` (Prisma)

### 4. SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–∫–∞–∑ —Ç–æ–≤–∞—Ä–æ–≤ —É –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–∞
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `SUPPLIER-{invoice_number}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SUPPLIER-–°—á–µ—Ç-1701234567890`)
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑**: Invoice –∏–ª–∏ Order (—Ç—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç)
- **–ú–æ–¥–µ–ª—å**: `supplier_orders` (Prisma)

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–≤—è–∑–µ–π

–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –¥–≤–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –ø–æ–ª—è:

#### 1. `parent_document_id` (String?)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ü–µ–ø–æ—á–∫–µ
- **–ó–Ω–∞—á–µ–Ω–∏—è**:
  - `null` - –∏—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–Ω–µ —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–æ–≥–æ)
  - `"quote_id"` - —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ö–ü
  - `"invoice_id"` - —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –°—á–µ—Ç–∞
  - `"order_id"` - —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ó–∞–∫–∞–∑–∞

#### 2. `cart_session_id` (String?)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: `generateCartSessionId()` –∏–∑ `lib/utils/cart-session.ts`

### –¶–µ–ø–æ—á–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```
–ö–ü (Quote)
  ‚Üì parent_document_id
–°—á–µ—Ç (Invoice) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ –ö–ü)
  ‚Üì order_id (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å)
–ó–∞–∫–∞–∑ (Order) ‚Üê invoice_id (–æ–¥–∏–Ω —Å—á–µ—Ç –Ω–∞ –∑–∞–∫–∞–∑)
  ‚Üì parent_document_id
–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ (SupplierOrder) ‚Üê parent_document_id (—Å—Å—ã–ª–∫–∞ –Ω–∞ Invoice –∏–ª–∏ Order)
```

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏

#### Order ‚Üî Invoice
- **Order.invoice_id** ‚Üí **Invoice.id** (–æ–¥–∏–Ω —Å—á–µ—Ç –Ω–∞ –∑–∞–∫–∞–∑)
- **Invoice.order_id** ‚Üí **Order.id** (—Å—á–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∑–∞–∫–∞–∑—É)
- **–í–∞–∂–Ω–æ**: Order –∏ Invoice —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —á–µ—Ä–µ–∑ `/api/orders/create-with-invoice`

---

## üìä –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ —Å—Ç–∞—Ç—É—Å—ã

### Quote (–ö–ü) - –°—Ç–∞—Ç—É—Å—ã

```
DRAFT (–ß–µ—Ä–Ω–æ–≤–∏–∫)
  ‚Üì
SENT (–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
  ‚Üì
ACCEPTED (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ) –∏–ª–∏ REJECTED (–û—Ç–∫–∞–∑)
  ‚Üì
CANCELLED (–û—Ç–º–µ–Ω–µ–Ω) - –∏–∑ –ª—é–±–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `DRAFT` - –ß–µ—Ä–Ω–æ–≤–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `SENT` - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É
- `ACCEPTED` - –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–º
- `REJECTED` - –û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞
- `CANCELLED` - –û—Ç–º–µ–Ω–µ–Ω

**–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
- `DRAFT` ‚Üí `SENT`: COMPLECTATOR, ADMIN
- `SENT` ‚Üí `ACCEPTED`: –ö–ª–∏–µ–Ω—Ç (—á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- `SENT` ‚Üí `REJECTED`: –ö–ª–∏–µ–Ω—Ç (—á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- –õ—é–±–æ–π ‚Üí `CANCELLED`: ADMIN, COMPLECTATOR

### Invoice (–°—á–µ—Ç) - –°—Ç–∞—Ç—É—Å—ã

```
DRAFT (–ß–µ—Ä–Ω–æ–≤–∏–∫)
  ‚Üì
SENT (–û—Ç–ø—Ä–∞–≤–ª–µ–Ω)
  ‚Üì
PAID (–û–ø–ª–∞—á–µ–Ω) ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è Order
  ‚Üì
ORDERED (–ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω)
  ‚Üì
RECEIVED_FROM_SUPPLIER (–ü–æ–ª—É—á–µ–Ω –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
  ‚Üì
COMPLETED (–ò—Å–ø–æ–ª–Ω–µ–Ω)
  ‚Üì
CANCELLED (–û—Ç–º–µ–Ω–µ–Ω) - –∏–∑ –ª—é–±–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `DRAFT` - –ß–µ—Ä–Ω–æ–≤–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `SENT` - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É
- `PAID` - –û–ø–ª–∞—á–µ–Ω/–ó–∞–∫–∞–∑ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç Order)
- `ORDERED` - –ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω
- `RECEIVED_FROM_SUPPLIER` - –ü–æ–ª—É—á–µ–Ω –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `COMPLETED` - –ò—Å–ø–æ–ª–Ω–µ–Ω
- `CANCELLED` - –û—Ç–º–µ–Ω–µ–Ω

**–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
- `DRAFT` ‚Üí `SENT`: COMPLECTATOR, ADMIN
- `SENT` ‚Üí `PAID`: –ö–ª–∏–µ–Ω—Ç (—á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å), –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `PAID` —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Order
- `PAID` ‚Üí `ORDERED`: ADMIN, COMPLECTATOR
- `ORDERED` ‚Üí `RECEIVED_FROM_SUPPLIER`: ADMIN, EXECUTOR
- `RECEIVED_FROM_SUPPLIER` ‚Üí `COMPLETED`: ADMIN, EXECUTOR
- –õ—é–±–æ–π ‚Üí `CANCELLED`: ADMIN

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ `SENT` ‚Üí `PAID`: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è **Order** —Å –Ω–æ–º–µ—Ä–æ–º `–ó–∞–∫–∞–∑-XXX`
- Order –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ Invoice —á–µ—Ä–µ–∑ `order_id` –∏ `invoice_id`
- –ï—Å–ª–∏ Order —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

### Order (–ó–∞–∫–∞–∑) - –°—Ç–∞—Ç—É—Å—ã

```
NEW_PLANNED (–ù–æ–≤—ã–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  ‚Üì
UNDER_REVIEW (–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ) - —Ç—Ä–µ–±—É–µ—Ç—Å—è project_file_url
  ‚Üì
AWAITING_MEASUREMENT (–û–∂–∏–¥–∞–µ—Ç –∑–∞–º–µ—Ä–∞)
  ‚Üì
AWAITING_INVOICE (–û–∂–∏–¥–∞–µ—Ç —Å—á–µ—Ç–∞)
  ‚Üì
COMPLETED (–í—ã–ø–æ–ª–Ω–µ–Ω)
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `NEW_PLANNED` - –ù–æ–≤—ã–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `UNDER_REVIEW` - –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞)
- `AWAITING_MEASUREMENT` - –û–∂–∏–¥–∞–µ—Ç –∑–∞–º–µ—Ä–∞
- `AWAITING_INVOICE` - –û–∂–∏–¥–∞–µ—Ç —Å—á–µ—Ç–∞
- `COMPLETED` - –í—ã–ø–æ–ª–Ω–µ–Ω

**–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
- `NEW_PLANNED` ‚Üí `UNDER_REVIEW`: EXECUTOR, ADMIN (—Ç—Ä–µ–±—É–µ—Ç `project_file_url`)
- `UNDER_REVIEW` ‚Üí `AWAITING_MEASUREMENT`: EXECUTOR, ADMIN
- `UNDER_REVIEW` ‚Üí `AWAITING_INVOICE`: EXECUTOR, ADMIN
- `AWAITING_MEASUREMENT` ‚Üí `AWAITING_INVOICE`: EXECUTOR, ADMIN
- `AWAITING_INVOICE` ‚Üí `COMPLETED`: EXECUTOR, ADMIN

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Invoice:**
- –î–ª—è **COMPLECTATOR**: —Å—Ç–∞—Ç—É—Å—ã Order —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ Invoice
- –î–ª—è **EXECUTOR**: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã Order
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤–∏–¥–Ω—ã –≤—Å–µ–º —Ä–æ–ª—è–º

### SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞) - –°—Ç–∞—Ç—É—Å—ã

```
PENDING (–í –æ–∂–∏–¥–∞–Ω–∏–∏) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  ‚Üì
ORDERED (–ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω)
  ‚Üì
RECEIVED_FROM_SUPPLIER (–ü–æ–ª—É—á–µ–Ω –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
  ‚Üì
COMPLETED (–í—ã–ø–æ–ª–Ω–µ–Ω)
  ‚Üì
CANCELLED (–û—Ç–º–µ–Ω–µ–Ω) - –∏–∑ –ª—é–±–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `PENDING` - –í –æ–∂–∏–¥–∞–Ω–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `ORDERED` - –ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω
- `RECEIVED_FROM_SUPPLIER` - –ü–æ–ª—É—á–µ–Ω –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `COMPLETED` - –í—ã–ø–æ–ª–Ω–µ–Ω
- `CANCELLED` - –û—Ç–º–µ–Ω–µ–Ω

**–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
- `PENDING` ‚Üí `ORDERED`: ADMIN, EXECUTOR
- `ORDERED` ‚Üí `RECEIVED_FROM_SUPPLIER`: ADMIN, EXECUTOR
- `RECEIVED_FROM_SUPPLIER` ‚Üí `COMPLETED`: ADMIN, EXECUTOR
- –õ—é–±–æ–π ‚Üí `CANCELLED`: ADMIN

---

## üõí –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã

#### Quote (–ö–ü)
- **API**: `/api/cart/export/enhanced` –∏–ª–∏ `/api/documents/create`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ type: 'quote', cart, clientId, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è –ö–ü —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º `cart_data`
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `parent_document_id`, `cart_session_id`, `client_id`, `total_amount`, `cart_data`

#### Invoice (–°—á–µ—Ç)
- **API**: `/api/cart/export/enhanced` –∏–ª–∏ `/api/documents/create`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ type: 'invoice', cart, clientId, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è –°—á–µ—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º `cart_data`
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ö–ü

#### Order + Invoice (–ó–∞–∫–∞–∑ –∏ –°—á–µ—Ç –≤–º–µ—Å—Ç–µ)
- **API**: `/api/orders/create-with-invoice`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ client_id, items, total_amount, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
  1. –°–æ–∑–¥–∞–µ—Ç—Å—è **Order** —Å –Ω–æ–º–µ—Ä–æ–º `–ó–∞–∫–∞–∑-XXX`
  2. –°–æ–∑–¥–∞–µ—Ç—Å—è **Invoice** —Å –Ω–æ–º–µ—Ä–æ–º `–°—á–µ—Ç-{timestamp}`
  3. Invoice –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ Order —á–µ—Ä–µ–∑ `order_id` –∏ `invoice_id`
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: 
  - –î–ª—è Order –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–≤—è–∑–∞–Ω–Ω—ã–π Invoice (`invoice.cart_data`, `invoice.total_amount`)
  - –î–ª—è Invoice —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

#### SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- **API**: `/api/supplier-orders`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ invoiceId | orderId, supplierName, supplierEmail, supplierPhone, expectedDate, notes, cartData }`
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –î–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å Invoice –∏–ª–∏ Order (–∏—Å—Ç–æ—á–Ω–∏–∫)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è SupplierOrder —Å –Ω–æ–º–µ—Ä–æ–º `SUPPLIER-{invoice_number}`
- **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `parent_document_id`, `cart_session_id`, `cart_data`

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ

#### Order –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice
- **–¢—Ä–∏–≥–≥–µ—Ä**: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Invoice: `SENT` ‚Üí `PAID`
- **API**: `/api/invoices/[id]/status` (PUT)
- **–õ–æ–≥–∏–∫–∞**:
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Order –¥–ª—è —ç—Ç–æ–≥–æ Invoice
  2. –ï—Å–ª–∏ Order –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π Order —Å –Ω–æ–º–µ—Ä–æ–º `–ó–∞–∫–∞–∑-XXX`
  3. Order –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ Invoice —á–µ—Ä–µ–∑ `order_id` –∏ `invoice_id`
  4. Order –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `NEW_PLANNED`

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

#### Invoice –∏–∑ Quote
- **API**: `/api/documents/create` –∏–ª–∏ `/api/cart/export/enhanced`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ type: 'invoice', parent_document_id: quoteId, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Invoice —Å `parent_document_id = quoteId`

#### SupplierOrder –∏–∑ Invoice/Order
- **API**: `/api/supplier-orders`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ invoiceId | orderId, ... }`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: SupplierOrder —Å `parent_document_id = invoiceId` –∏–ª–∏ `orderId`

---

## üîç –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏

### –¶–µ–ª—å
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏:
- –ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∫–ª–∏–∫–∞—Ö –Ω–∞ –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∏–∑ –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã
- –°–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

–î–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∫—Ä–æ–º–µ Order):

1. **parent_document_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è `null`)
2. **cart_session_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è `null`)
3. **client_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
4. **total_amount** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–¥–æ–ø—É—Å–∫ ¬±0.01 –¥–ª—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è)
5. **cart_data** - –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã

### –î–ª—è Order (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞)

Order –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–≤—è–∑–∞–Ω–Ω—ã–π Invoice:
1. **parent_document_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
2. **cart_session_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
3. **client_id** - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
4. **invoice.total_amount** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—É–º–º—ã —á–µ—Ä–µ–∑ Invoice
5. **invoice.cart_data** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —á–µ—Ä–µ–∑ Invoice

### –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏

```typescript
async function findExistingDocument(
  type: 'quote' | 'invoice' | 'order' | 'supplier_order',
  parentDocumentId: string | null,
  cartSessionId: string | null,
  clientId: string,
  items: any[],
  totalAmount: number
): Promise<Document | null> {
  // –≠—Ç–∞–ø 1: –°—Ç—Ä–æ–≥–∏–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
  let existing = await prisma[type].findFirst({
    where: {
      parent_document_id: parentDocumentId,
      cart_session_id: cartSessionId,
      client_id: clientId,
      total_amount: totalAmount // –¥–ª—è Order —á–µ—Ä–µ–∑ invoice.total_amount
    }
  });
  
  if (existing) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã
    if (compareCartContent(items, existing.cart_data)) {
      return existing; // –ù–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç
    }
  }
  
  // –≠—Ç–∞–ø 2: –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –∫–æ—Ä–∑–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ –∫–ª–∏–µ–Ω—Ç–∞)
  const candidates = await prisma[type].findMany({
    where: {
      client_id: clientId, // –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ –∫–ª–∏–µ–Ω—Ç–∞!
      parent_document_id: parentDocumentId,
      total_amount: {
        gte: totalAmount - 0.01,
        lte: totalAmount + 0.01
      }
    },
    orderBy: { created_at: 'desc' },
    take: 10
  });
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
  for (const candidate of candidates) {
    if (compareCartContent(items, candidate.cart_data)) {
      return candidate; // –ù–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
    }
  }
  
  return null; // –î—É–±–ª–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
}
```

### –§—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã

```typescript
function compareCartContent(items1: any[], items2String: string | null): boolean {
  if (!items2String) return false;
  
  try {
    const items2 = JSON.parse(items2String);
    const normalized1 = normalizeItems(items1);
    const normalized2 = normalizeItems(items2);
    
    if (normalized1.length !== normalized2.length) return false;
    
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ product_id, quantity, unitPrice
    const sorted1 = normalized1.sort((a, b) => a.productId.localeCompare(b.productId));
    const sorted2 = normalized2.sort((a, b) => a.productId.localeCompare(b.productId));
    
    return sorted1.every((item1, index) => {
      const item2 = sorted2[index];
      return (
        item1.productId === item2.productId &&
        item1.quantity === item2.quantity &&
        Math.abs(item1.unitPrice - item2.unitPrice) < 0.01
      );
    });
  } catch (error) {
    return false;
  }
}
```

---

## üë• –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. **ADMIN** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
2. **COMPLECTATOR** - –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
3. **EXECUTOR** - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∑–∞–∫–∞–∑–∞–º–∏

### –ü—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### Quote (–ö–ü)
- **COMPLECTATOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- **EXECUTOR**: ‚ùå –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

#### Invoice (–°—á–µ—Ç)
- **COMPLECTATOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã, –∏–∑ –ö–ü
- **EXECUTOR**: ‚ùå –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å Order)
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

#### Order (–ó–∞–∫–∞–∑)
- **COMPLECTATOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (–∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑")
- **EXECUTOR**: ‚úÖ –í–∏–¥–µ—Ç—å –∑–∞–∫–∞–∑—ã, –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**: –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ Invoice (`PAID`)

#### SupplierOrder (–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- **COMPLECTATOR**: ‚ùå –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å
- **EXECUTOR**: ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ Invoice/Order
- **ADMIN**: ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

### –ü—Ä–∞–≤–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

–°–º. —Ä–∞–∑–¥–µ–ª "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ —Å—Ç–∞—Ç—É—Å—ã" –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

---

## üì° API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### POST `/api/documents/create`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–µ–π
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç**: `quote`, `invoice`, `order`, `supplier_order`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "type": "quote|invoice|order|supplier_order",
    "client_id": "string",
    "items": [...],
    "total_amount": 0,
    "parent_document_id": "string|null",
    "cart_session_id": "string|null",
    "prevent_duplicates": true
  }
  ```

#### POST `/api/orders/create-with-invoice`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ Order –∏ Invoice –≤–º–µ—Å—Ç–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "client_id": "string",
    "items": [...],
    "total_amount": 0,
    "subtotal": 0,
    "tax_amount": 0,
    "notes": "string"
  }
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
  ```json
  {
    "order": { id, number, status, ... },
    "invoice": { id, number, status, ... },
    "message": "–ó–∞–∫–∞–∑ –∏ —Å—á–µ—Ç —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ"
  }
  ```

#### POST `/api/supplier-orders`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "invoiceId": "string" | "orderId": "string",
    "supplierName": "string",
    "supplierEmail": "string",
    "supplierPhone": "string",
    "expectedDate": "YYYY-MM-DD",
    "notes": "string",
    "cartData": { items: [...] }
  }
  ```

#### POST `/api/cart/export/enhanced`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –≠–∫—Å–ø–æ—Ä—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (PDF/Excel)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç**: `quote`, `invoice`, `order`, `supplier_order`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  ```json
  {
    "cart": { items: [...] },
    "documentType": "quote|invoice|order|supplier_order",
    "format": "pdf|excel|csv",
    "clientId": "string",
    "sourceDocumentId": "string",
    "sourceDocumentType": "string"
  }
  ```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

#### PUT `/api/invoices/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "DRAFT|SENT|PAID|...", notes?: "string" }`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**: –ü—Ä–∏ `PAID` —Å–æ–∑–¥–∞–µ—Ç Order, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

#### PUT `/api/orders/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "NEW_PLANNED|UNDER_REVIEW|...", require_measurement?: boolean }`

#### PUT `/api/quotes/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "DRAFT|SENT|ACCEPTED|..." }`

#### PUT `/api/supplier-orders/[id]/status`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `{ status: "PENDING|ORDERED|..." }`

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### GET `/api/quotes` - –°–ø–∏—Å–æ–∫ –ö–ü
#### GET `/api/invoices` - –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
#### GET `/api/orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
#### GET `/api/supplier-orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞

---

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ö–æ—Ä–∑–∏–Ω–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### `EnhancedCartSidebar`
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `DocumentWorkflowIntegration`
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
  - –ö–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
    - "–ö–ü" ‚Üí —Å–æ–∑–¥–∞–µ—Ç Quote
    - "–°—á–µ—Ç" ‚Üí —Å–æ–∑–¥–∞–µ—Ç Invoice
    - **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"** ‚Üí —Å–æ–∑–¥–∞–µ—Ç Order + Invoice —á–µ—Ä–µ–∑ `/api/orders/create-with-invoice`
    - "–ó–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞" ‚Üí —Å–æ–∑–¥–∞–µ—Ç SupplierOrder (—Ç—Ä–µ–±—É–µ—Ç Invoice/Order)
  - –î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ

#### `QuickCartSidebar`
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–æ—Ä–∑–∏–Ω—ã
- **–§—É–Ω–∫—Ü–∏–∏**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `EnhancedCartSidebar`

#### `CartManager` (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/doors`)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/doors/page.tsx`
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä–∞ –¥–≤–µ—Ä–µ–π
  - –ö–Ω–æ–ø–∫–∞ **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"** ‚Üí —Å–æ–∑–¥–∞–µ—Ç Order + Invoice —á–µ—Ä–µ–∑ `/api/orders/create-with-invoice`

### –î–∞—à–±–æ—Ä–¥—ã

#### –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä (`/complectator/dashboard`)
- **–í–∫–ª–∞–¥–∫–∏**: –ö–æ—Ä–∑–∏–Ω–∞, –î–æ–∫—É–º–µ–Ω—Ç—ã, –ó–∞–∫–∞–∑—ã
- **–í–∫–ª–∞–¥–∫–∞ "–ö–æ—Ä–∑–∏–Ω–∞"**: `DocumentWorkflowIntegration` —Å –∫–Ω–æ–ø–∫–æ–π "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"
- **–í–∫–ª–∞–¥–∫–∞ "–î–æ–∫—É–º–µ–Ω—Ç—ã"**: –ü—Ä–æ—Å–º–æ—Ç—Ä –ö–ü, –°—á–µ—Ç–æ–≤, –ó–∞–∫–∞–∑–æ–≤ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º

#### –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (`/executor/dashboard`)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `OrdersBoard` - —Ç–∞–±–ª–æ –∑–∞–∫–∞–∑–æ–≤
- **–§—É–Ω–∫—Ü–∏–∏**: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üîÑ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ—Ç –∫–æ—Ä–∑–∏–Ω—ã –¥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞

1. **–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä** –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ù–∞–∂–∏–º–∞–µ—Ç **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Order** (`–ó–∞–∫–∞–∑-123`)
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Invoice** (`–°—á–µ—Ç-...`)
   - Invoice –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Order —á–µ—Ä–µ–∑ `order_id` –∏ `invoice_id`
3. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å Invoice: `DRAFT` ‚Üí `SENT`
4. –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç: —Å—Ç–∞—Ç—É—Å Invoice ‚Üí `PAID`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è Order (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
5. **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å** —Å–æ–∑–¥–∞–µ—Ç **SupplierOrder** –Ω–∞ –æ—Å–Ω–æ–≤–µ Invoice
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/supplier-orders` —Å `invoiceId`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è `SUPPLIER-–°—á–µ—Ç-...`
6. SupplierOrder –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å—ã: `PENDING` ‚Üí `ORDERED` ‚Üí `RECEIVED_FROM_SUPPLIER` ‚Üí `COMPLETED`
7. Order –∏ Invoice –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ –ö–ü

1. **–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä** —Å–æ–∑–¥–∞–µ—Ç **Quote** –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
2. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å Quote: `DRAFT` ‚Üí `SENT`
3. –ö–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç: Quote ‚Üí `ACCEPTED`
4. –°–æ–∑–¥–∞–µ—Ç **Invoice** –Ω–∞ –æ—Å–Ω–æ–≤–µ Quote
   - `parent_document_id = quoteId`
   - `cart_session_id` —Ç–æ—Ç –∂–µ
5. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å Invoice: `DRAFT` ‚Üí `SENT`
6. –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç: Invoice ‚Üí `PAID`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è **Order**
7. –î–∞–ª—å—à–µ –∫–∞–∫ –≤ –°—Ü–µ–Ω–∞—Ä–∏–∏ 1

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä—è–º–æ–π –∑–∞–∫–∞–∑ (–±–µ–∑ –ö–ü)

1. **–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä** –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ù–∞–∂–∏–º–∞–µ—Ç **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è **Order** –∏ **Invoice** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - `parent_document_id = null` (–ø—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ)
3. –î–∞–ª—å—à–µ –∫–∞–∫ –≤ –°—Ü–µ–Ω–∞—Ä–∏–∏ 1

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç **"–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"** –¥–≤–∞–∂–¥—ã –ø–æ–¥—Ä—è–¥
2. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–µ—Ç Order –∏ Invoice
3. –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –Ω–∞—Ö–æ–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Order —á–µ—Ä–µ–∑ –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—é
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Order, –¥—É–±–ª–∏–∫–∞—Ç –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

1. **–ö–ª–∏–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∫–∞ `client_id` –≤ –ë–î
2. **–ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞**: `items.length > 0`
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
4. **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

1. **–î–æ–∫—É–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
2. **–ü–µ—Ä–µ—Ö–æ–¥ —Ä–∞–∑—Ä–µ—à–µ–Ω**: –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `STATUS_TRANSITIONS`
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
4. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ `isStatusBlocked()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
5. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**: –ù–∞–ø—Ä–∏–º–µ—Ä, `project_file_url` –¥–ª—è `UNDER_REVIEW` –≤ Order

### –ê—É–¥–∏—Ç

- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `DocumentHistory`
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –≤ `DocumentComment`
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ `Notification` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Order –∏ Invoice —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ**: –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `/api/orders/create-with-invoice` —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–±–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –≤–∑–∞–∏–º–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–æ–π.

2. **–û–¥–∏–Ω Invoice –Ω–∞ Order**: Order –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω Invoice (—á–µ—Ä–µ–∑ `invoice_id`), –Ω–æ Invoice –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Order (—á–µ—Ä–µ–∑ `order_id`).

3. **–ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤**: –û–¥–∏–Ω Client –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ Orders, –Ω–æ –∫–∞–∂–¥—ã–π Order –∏–º–µ–µ—Ç —Å–≤–æ–π Invoice.

4. **SupplierOrder —Ç—Ä–µ–±—É–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫**: –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å SupplierOrder –±–µ–∑ Invoice –∏–ª–∏ Order.

5. **–î–µ–¥—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤–µ—Ä–Ω–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç.

6. **–°—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è**: –î–ª—è COMPLECTATOR —Å—Ç–∞—Ç—É—Å—ã Order —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ Invoice; –¥–ª—è EXECUTOR –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã Order.

7. **–ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è**: –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∫–æ—Ä–∑–∏–Ω–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## üöÄ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–≤—è–∑—è–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
```
GET /api/documents/{id}/chain
```

### –ü–æ–ª—É—á–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```
GET /api/documents/{id}/related?type=all|quote|invoice|order|supplier_order
```

### –ü–æ–ª—É—á–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```
GET /api/documents/{id}/children
```

### –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç
```
GET /api/documents/{id}/siblings
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-11-03  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

