#!/usr/bin/env bash
set -euo pipefail

# ---------- master_spec.md ----------
cat > master_spec.md <<'EOF'
Title: Domeo â€” Master Spec (Doors Pilot)
Owner: @TechLead + @Product
Last updated (Europe/Paris): 2025-09-12
Related: [Roadmap](./roadmap.md), [State](./state.md), [Admin Guide](./admin_guide.md),
         [Data Import Guide Doors](./data_import_guide_doors.md), [Spec ĞšĞŸ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹](./spec_kp_formulas.md),
         [Sync Guide](./sync_guide.md)

# Domeo No-Code Calculators â€” Master Spec (Pilot: Doors)

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 0.4 (2025-09-12)
**ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹:** Yandex Cloud (prod), GitHub (ĞºĞ¾Ğ´/CI), Replit (ÑÑ‚ĞµĞ½Ğ´/Ğ´ĞµĞ¼Ğ¾).

## 1. Ğ¦ĞµĞ»ÑŒ
ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ â†’ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ‚Ğ¾Ñ€ â†’ ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° (Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½-Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€, **auto-pricing**) â†’ ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚ (HTMLâ†’PDF) â†’ Â«Ğ—Ğ°ĞºĞ°Ğ· Ğ½Ğ° Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºÑƒÂ» (CSV/XLSX).

## 2. Ğ Ğ¾Ğ»Ğ¸
ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚Ğ°Ñ‚Ğ¾Ñ€, Admin, Manager, Viewer. GPT â€” ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¸ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Â«Ğ¸ÑÑ‚Ğ¸Ğ½Â».

## 3. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸
- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ‚Ğ¾Ñ€: **finish, color, type, width, height**, Ğ²Ñ‹Ğ±Ğ¾Ñ€ `hardware_kit` Ğ¸ `handle`.
- ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°: Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸, **Ğ´ĞµĞ»ÑŒÑ‚Ğ°** Ğº Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ Ñ†ĞµĞ½Ğµ; ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ **ĞšĞŸ / Ğ¡Ñ‡Ñ‘Ñ‚ / Ğ—Ğ°ĞºĞ°Ğ·**.

## 4. ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ° No-Code
Wizard: ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ â†’ Attributes (Ñ `dependsOn`) â†’ UI Flow â†’ Pricing DSL â†’ Export Templates â†’ Fixtures â†’ Import.

## 5. Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° (Doors)
- **Product key (Ğ²Ğ¸Ñ‚Ñ€Ğ¸Ğ½Ğ°):** `(model, finish, color|domeo_color, type, width, height)` â†” Ğ¾Ğ´Ğ½Ğ° ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ.
  **Ğ‘Ğ”:** Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½ **UNIQUE INDEX** `products(model,finish,color,type,width,height)` (Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»ĞµĞ¹ Ğ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ UPSERT).
- **Ğ Ğ Ğ¦ ĞµĞ´Ğ¸Ğ½Ğ°Ñ Ğ½Ğ° ĞºĞ»ÑÑ‡.** Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ Ğ Ğ¦ Ğ¾Ñ‚ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ñ‰Ğ¸ĞºĞ¾Ğ² â†’ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ â†’ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ + Ğ²Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ°Ğ½Ğ¾Ğ½Ğ° (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ **Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ**).
- **Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚:**
  - **ĞšĞŸ, Ğ¡Ñ‡Ñ‘Ñ‚** â€” HTML (Ğ¿ĞµÑ‡Ğ°Ñ‚ÑŒ/ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² PDF).
  - **Ğ—Ğ°ĞºĞ°Ğ· Ğ½Ğ° Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºÑƒ** â€” CSV/XLSX.
  - Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ° **Ñ€ÑƒÑ‡ĞºĞ°** â€” Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ²ĞµÑ€Ğ¸ (qty = qty Ğ´Ğ²ĞµÑ€Ğ¸).
- **Ğ”ĞµĞ»ÑŒÑ‚Ğ° Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğµ:** `(Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ Ñ†ĞµĞ½Ğ°) âˆ’ (Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ñ†ĞµĞ½Ğ° Ğ¿Ñ€Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸)`.
- **Auto-pricing:** Ñ†ĞµĞ½Ğ° Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°.

## 6. Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹ Ğ Ğ Ğ¦
Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ XLSX/CSV â†’ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ â†’ **CSV-Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²** `/static/import_reports/doors/*.csv` â†’ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ°Ğ½Ğ¾Ğ½Ğ° â†’ **safe UPSERT**.

## 7. API (Ğ²Ñ‹Ğ¶Ğ¸Ğ¼ĞºĞ°)
- `GET /catalog/doors/options` â€” **dependsOn** Ğ´Ğ¾Ğ¼ĞµĞ½Ñ‹. Ğ¦ĞµĞ¿Ğ¾Ñ‡ĞºĞ°: `style â†’ model â†’ finish â†’ color â†’ type â†’ width â†’ height`.
  `kits`/`handles` Ğ¿Ğ¾Ğ´Ğ¼ĞµÑˆĞ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ¸Ğ· ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ².
- `POST /price/doors` â€” Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ auto-pricing).
- `POST /cart/export/doors/{kp|invoice}` â€” HTML (Ğ¿Ğ¾Ğ´ Ğ¿ĞµÑ‡Ğ°Ñ‚ÑŒ PDF).
- `POST /cart/export/doors/factory` â€” CSV/XLSX.

## 8. ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ñ†ĞµĞ½ Ñ€ÑƒÑ‡ĞµĞº (ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚)
Ğ¦ĞµĞ½Ğ° Ñ€ÑƒÑ‡ĞºĞ¸ = `handle.price_rrc`; ĞµÑĞ»Ğ¸ Ğ¿ÑƒÑÑ‚Ğ¾ â†’ `round(handle.price_opt * handle.price_group_multiplier)`.

## 9. Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ĞºĞ¸
Options ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ dependsOn; `/price` ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾; ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ñ‹ Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒÑÑ‚ÑÑ; Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµÑ‚ UPSERT; ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚.
EOF

# ---------- admin_guide.md ----------
cat > admin_guide.md <<'EOF'
Title: Domeo â€” Admin Guide (Doors Pilot)
Owner: @Analyst (Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ°)
Last updated (Europe/Paris): 2025-09-12
Related: [Master Spec](./master_spec.md), [Roadmap](./roadmap.md), [State](./state.md),
         [Data Import Guide Doors](./data_import_guide_doors.md), [Spec ĞšĞŸ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹](./spec_kp_formulas.md)

# Domeo No-Code Admin â€” Ğ ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°

## 1) Ğ Ğ¾Ğ»Ğ¸: Admin / Manager / Viewer

## 2) Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
Wizard â†’ Attributes (Ñ `dependsOn`) â†’ UI Flow â†’ **Pricing DSL** â†’ Export Templates â†’ Fixtures â†’ Import â†’ **Preview** â†’ Publish.  
**Auto-pricing:** Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ†ĞµĞ½Ñƒ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ².

## 3) Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¿Ñ€Ğ°Ğ¹ÑĞ¾Ğ² (XLSX/CSV)
1) Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ° â†’ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ â†’ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ.  
2) ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ **CSV-Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ° ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ Ğ Ğ¦** (`/static/import_reports/doors/*.csv`).  
3) Ğ’Ñ‹Ğ±Ğ¾Ñ€ **ĞºĞ°Ğ½Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ Ğ Ğ¦** (Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚ â€” Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ) Ğ¸Ğ»Ğ¸ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ²Ğ²Ğ¾Ğ´.  
4) ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ **safe UPSERT** (Ğ¿Ğ¾Ğ´ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ product key).  
5) Ğ’ Ğ¶ÑƒÑ€Ğ½Ğ°Ğ»Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° CSV-Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚.

## 4) ĞœĞµĞ´Ğ¸Ğ°-Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€
Upload â†’ `media_id` â†’ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ° `/media/:id` Ğ¸ `/media/:id/fit?w=&h=`.

## 5) ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¸ smoke-Ñ‚ĞµÑÑ‚Ñ‹
- **/catalog/doors/options** â€” dependsOn-Ğ´Ğ¾Ğ¼ĞµĞ½Ñ‹.  
- **/price/doors** â€” **auto-pricing**.  
- **Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ñ‹:** ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚ (HTMLâ†’PDF), Ğ—Ğ°ĞºĞ°Ğ· (CSV/XLSX).
EOF

# ---------- data_import_guide_doors.md ----------
cat > data_import_guide_doors.md <<'EOF'
# Ğ ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (ĞŸĞ¸Ğ»Ğ¾Ñ‚: Doors)
Last updated (Europe/Paris): 2025-09-12

## 1) ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ°
XLSX/CSV, UTF-8. ĞĞ½Ñ‚Ğ¸-CSV Ğ¸Ğ½ÑŠĞµĞºÑ†Ğ¸Ğ¸: Ğ¿Ğ¾Ğ»Ñ, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‰Ğ¸ĞµÑÑ Ñ `=,+,-`, ÑĞºÑ€Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ `'`.

## 2) ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€)
{
  "mapping": {
    "model": "ĞœĞ¾Ğ´ĞµĞ»ÑŒ",
    "style": "Ğ¡Ñ‚Ğ¸Ğ»ÑŒ",
    "finish": "ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ",
    "domeo_color": "Ğ¦Ğ²ĞµÑ‚",
    "type": "Ğ¢Ğ¸Ğ¿",
    "width": "Ğ¨Ğ¸Ñ€Ğ¸Ğ½Ğ°",
    "height": "Ğ’Ñ‹ÑĞ¾Ñ‚Ğ°",
    "rrc_price": "Ğ Ğ Ğ¦",
    "photo_url": "Ğ¤Ğ¾Ñ‚Ğ¾"
  },
  "uniqueBy": ["model","finish","domeo_color","type","width","height"],
  "sheet": "ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³",
  "startRow": 2
}
**ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ:** `model, finish, color|domeo_color, type, width, height, rrc_price`.

## 3) ĞšĞ»ÑÑ‡ Ğ²Ğ¸Ñ‚Ñ€Ğ¸Ğ½Ñ‹ Ğ¸ Ğ¸Ğ½Ğ´ĞµĞºÑ
**ĞšĞ»ÑÑ‡:** `(model, finish, color|domeo_color, type, width, height)` â€” Ğ¾Ğ´Ğ½Ğ° ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ.  
**Ğ‘Ğ”:** Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½ **UNIQUE INDEX** (Ğ´ĞµÑ‚ĞµĞºÑ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ UPSERT).

## 4) ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹ Ğ Ğ Ğ¦ Ğ¸ UPSERT
1) Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¿Ğ¾Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ (Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ»ÑÑ‡, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ Ğ Ğ¦).  
2) Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ **CSV-Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚**: `/static/import_reports/doors/*.csv`.  
3) **ĞšĞ°Ğ½Ğ¾Ğ½ Ğ Ğ Ğ¦:** Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ â€” **Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ**, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ.  
4) **safe UPSERT** (INSERT ON CONFLICT â€¦ DO UPDATE).

## 5) Smoke-Ñ‚ĞµÑÑ‚Ñ‹
`GET /catalog/doors/options`, `POST /price/doors`, ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚/Ğ—Ğ°ĞºĞ°Ğ·.
EOF

# ---------- spec_kp_formulas.md ----------
cat > spec_kp_formulas.md <<'EOF'
Title: Domeo â€” Spec ĞšĞŸ (Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹)
Owner: @Analyst + @TechLead
Last updated (Europe/Paris): 2025-09-12
Related: [Master Spec](./master_spec.md), [Admin Guide](./admin_guide.md), [Data Import Guide Doors](./data_import_guide_doors.md),
         [Roadmap](./roadmap.md), [State](./state.md), [Sync Guide](./sync_guide.md)

# ĞšĞ¾Ğ¼Ğ¼ĞµÑ€Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ (ĞšĞŸ)
1) â„– â€” ÑĞºĞ²Ğ¾Ğ·Ğ½Ğ°Ñ Ğ½ÑƒĞ¼ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ²ĞµÑ€ĞµĞ¹.  
2) ĞĞ°Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ â€” `{{ĞœĞ¾Ğ´ĞµĞ»ÑŒ}} ({{Ğ¨Ã—Ğ’}}, {{Ğ¦Ğ²ĞµÑ‚}}{,{ ĞšÑ€Ğ¾Ğ¼ĞºĞ°: {{Ğ•ÑĞ»Ğ¸ ĞºÑ€Ğ¾Ğ¼ĞºĞ° Ğ´Ğ°}}}})` Ğ¿Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¼.  
3) **Ğ¦ĞµĞ½Ğ° Ğ Ğ Ğ¦** â€” Ğ¸Ğ· Ğ²Ğ¸Ñ‚Ñ€Ğ¸Ğ½Ñ‹.  
4) ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ â€” Ğ¸Ğ· ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹.  
5) Ğ¡ÑƒĞ¼Ğ¼Ğ° â€” `Ğ¦ĞµĞ½Ğ° Ã— ĞšĞ¾Ğ»-Ğ²Ğ¾`.

## ĞŸĞ¾Ğ´ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ´Ğ»Ñ Ñ€ÑƒÑ‡ĞºĞ¸
- Ğ¦ĞµĞ½Ğ° Ñ€ÑƒÑ‡ĞºĞ¸ = `handle.price_rrc`; **ĞµÑĞ»Ğ¸ Ğ¿ÑƒÑÑ‚Ğ¾** â†’ `round(handle.price_opt * handle.price_group_multiplier)`.  
- ĞšĞ¾Ğ»-Ğ²Ğ¾ = qty Ğ´Ğ²ĞµÑ€Ğ¸.  
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: `Ğ ÑƒÑ‡ĞºĞ°: {{handle.name}} â€” {{handle.price_rrc_or_fallback}} Ã— {{qty}} = {{total}}`.

# Ğ—Ğ°ĞºĞ°Ğ· Ğ½Ğ° Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºÑƒ
**ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° (Ğ´Ğ²ĞµÑ€ÑŒ):** Ğ¿Ğ¾Ğ»Ñ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ñ‰Ğ¸ĞºĞ°, Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹, `price_opt`; **Ğ Ğ¾Ğ·Ğ½Ğ¸Ñ‡Ğ½Ğ°Ñ** = `rrc_price + (hardware_kit?.price_rrc || 0)`, qty, ÑÑƒĞ¼Ğ¼Ñ‹.  
**Ğ”Ğ¾Ğ¿. ÑÑ‚Ñ€Ğ¾ĞºĞ° (Ñ€ÑƒÑ‡ĞºĞ°):** ĞĞ°Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‚/Ñ€Ğ¾Ğ·Ğ½. Ñ†ĞµĞ½Ğ°, qty (= qty Ğ´Ğ²ĞµÑ€Ğ¸), ÑÑƒĞ¼Ğ¼Ñ‹.

# Ğ¡Ñ‡Ñ‘Ñ‚ (invoice)
ĞšĞ°Ğº Ğ² ĞšĞŸ; Ñ€ÑƒÑ‡ĞºĞ° â€” ĞºĞ°Ğº Ğ²Ñ‹ÑˆĞµ.

# ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°
ĞĞºÑ€ÑƒĞ³Ğ»ĞµĞ½Ğ¸Ğµ Ğ´ĞµĞ½ĞµĞ¶Ğ½Ñ‹Ñ…; ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ñ€ÑƒÑ‡ĞµĞº Ğ½Ğµ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ÑÑ‚ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Â«â„–Â». Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚: ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚ â€” HTML (Ğ¿ĞµÑ‡Ğ°Ñ‚ÑŒ PDF), Ğ—Ğ°ĞºĞ°Ğ· â€” CSV/XLSX.
EOF

# ---------- state.md ----------
cat > state.md <<'EOF'
Title: Domeo â€” State (Doors Pilot)
Owner: @Team Leads + @GPT
Last updated (Europe/Paris): 2025-09-12
Related: [Master Spec](./master_spec.md), [Roadmap](./roadmap.md), [Admin Guide](./admin_guide.md),
         [Data Import Guide Doors](./data_import_guide_doors.md), [Spec ĞšĞŸ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹](./spec_kp_formulas.md)

# STATE â€” Live (2025-09-12)

## Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ âœ…
- Backend: `GET /catalog/doors/options` Ñ **dependsOn** Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°Ğ¼Ğ¸.  
- Admin Import: **CSV-Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ Ğ Ğ¦** + **safe UPSERT**.  
- Front: **auto-pricing**; ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ñ‹: ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚ (HTML), Ğ—Ğ°ĞºĞ°Ğ· (CSV) â€” Ğ¿Ñ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚.

## Ğ’ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ ğŸ› 
- Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¿Ğ¸Ğ»Ğ¾Ñ‚Ğ° Doors (Ğ¿Ñ€Ğ°Ğ¹ÑÑ‹/ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°/Ñ„Ğ¾Ñ‚Ğ¾) â€” Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµĞ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ¼ĞµĞ´Ğ¸Ğ° Ğ¸ smoke-Ñ‚ĞµÑÑ‚Ñ‹.

## Ğ‘Ğ»Ğ¾ĞºĞµÑ€Ñ‹ â›”
- ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ¹ÑÑ‹ RRC (Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ€ĞµĞ·) Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼ĞµĞ´Ğ¸Ğ°-Ğ½Ğ°Ğ±Ğ¾Ñ€.

## Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸ â–¶
- Smoke-Ñ‚ĞµÑÑ‚Ñ‹ `/options`, `/price`, ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ².  
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° UNIQUE INDEX Ğ¿Ğ¾ product key Ğ² Ğ‘Ğ”.  
- ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚/Ğ—Ğ°ĞºĞ°Ğ·.
EOF

# ---------- roadmap.md ----------
cat > roadmap.md <<'EOF'
Title: Domeo â€” Roadmap (Doors Pilot)
Owner: @PM + @GPT
Last updated (Europe/Paris): 2025-09-12
Related: [Master Spec](./master_spec.md), [State](./state.md), [Admin Guide](./admin_guide.md),
         [Data Import Guide Doors](./data_import_guide_doors.md), [Spec ĞšĞŸ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹](./spec_kp_formulas.md), [Sync Guide](./sync_guide.md)

# Roadmap â€” Domeo No-Code Calculators (Pilot: Doors)

## Milestones
**M1 â€” Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Doors (DoD)**  
- ĞŸÑ€Ğ°Ğ¹Ñ (RRC) Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾ â†’ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ (Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ, Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹), **Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ Ğ Ğ¦**, **UPSERT**, smoke-Ñ‚ĞµÑÑ‚Ñ‹ `/options`, `/price` (**auto-pricing**), ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ **ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚/Ğ—Ğ°ĞºĞ°Ğ·** â†’ Ñ„Ğ¸ĞºÑĞ°Ñ†Ğ¸Ñ Ğ² `state.md`.

**M2 â€” CRUD ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ¾Ğ² + Pricing DSL**  
Admin CRUD ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹/Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»; Pricing v1 Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½; Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚.

**M3 â€” ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° + ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ñ‹**  
UI ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹ + ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ°; ĞšĞŸ/Ğ¡Ñ‡Ñ‘Ñ‚ (PDF), Ğ—Ğ°ĞºĞ°Ğ· (CSV/XLSX).

**M4 â€” Ğ ĞµĞ»Ğ¸Ğ·**  
CI/CD; systemd; PIT-Ğ±ÑĞºĞ°Ğ¿Ñ‹; Ğ´ĞµĞ¼Ğ¾ Â«Ğ½Ğ¾Ğ²Ğ°Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ğ±ĞµĞ· ĞºĞ¾Ğ´Ğ°Â».

## Ğ¡Ñ€Ğ¾ĞºĞ¸ (Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€)
- **M1:** Ğ´Ğ¾ 2025-09-20 (ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚ `/options` + Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚/ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹; Ğ¾ÑÑ‚Ğ°ÑÑ‚ÑÑ Ğ¼ĞµĞ´Ğ¸Ğ° Ğ¸ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ°Ğ¹Ñ).  
- **M2:** Ğ´Ğ¾ 2025-09-30.  
- **M3:** Ğ´Ğ¾ 2025-10-10.  
- **M4:** Ğ´Ğ¾ 2025-10-20.
EOF

echo "OK: files updated."
