# üîç –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –≤ –ª–æ–≥–∏–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–æ–ª—å—é 'client' –≤ Quotes

**–§–∞–π–ª**: `app/api/quotes/[id]/status/route.ts`

**–ü—Ä–æ–±–ª–µ–º–∞**: 
```typescript
await notifyUsersByRole('client', {
  clientId: quoteWithClient.client_id,
  documentId: id,
  ...
});
```

**–û—à–∏–±–∫–∞**: 
- `notifyUsersByRole` –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `CLIENT`
- –ù–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `users` **–ù–ï–¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `CLIENT`**
- –ö–ª–∏–µ–Ω—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `clients`, –∞ –Ω–µ `users`

**–†–µ—à–µ–Ω–∏–µ**: 
- –î–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å `client.user_id` (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ `client_id`

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –≤ Invoice

**–§–∞–π–ª**: `app/api/invoices/[id]/status/route.ts`

**–°—Ç—Ä–æ–∫–∞ 102**: `await notifyUsersByRole('executor', {...})`
**–°—Ç—Ä–æ–∫–∞ 117**: `await notifyUsersByRole('complectator', {...})`

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –†–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ UPPERCASE: `'EXECUTOR'`, `'COMPLECTATOR'`
- –ù–æ —Ñ—É–Ω–∫—Ü–∏—è `notifyUsersByRole` –¥–µ–ª–∞–µ—Ç `.toUpperCase()`, —Ç–∞–∫ —á—Ç–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞
- –ù–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ç–∞–∫–∏–º–∏ —Ä–æ–ª—è–º–∏

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ notifyUsersByRole

**–§–∞–π–ª**: `lib/notifications/status-notifications.ts` (—Å—Ç—Ä–æ–∫–∏ 103-105)

```typescript
async function notifyUsersByRole(role: string, message: string, documentId: string) {
  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–æ–ª–∏
  console.log(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ ${role}: ${message}`);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –≠—Ç–æ **–∑–∞–≥–ª—É—à–∫–∞**, –∞ –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
- –û–Ω–∞ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å, –Ω–µ —Å–æ–∑–¥–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ë–î

### 4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ SupplierOrder

**–§–∞–π–ª**: `app/api/supplier-orders/[id]/status/route.ts`

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ SupplierOrder
- –ù–æ —Å—Ç–∞—Ç—É—Å SupplierOrder –º–µ–Ω—è–µ—Ç—Å—è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è **–∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä—É** (–∑–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- –ù–æ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –ø—Ä–∏—à–µ–ª (RECEIVED_FROM_SUPPLIER), –∞ –Ω–µ –Ω–∞ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

---

## üîß –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### Invoice (–°—á–µ—Ç)

**PAID** ‚Üí –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (EXECUTOR)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –£–≤–µ–¥–æ–º–ª—è–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π, —á—Ç–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- –ö—Ç–æ –º–µ–Ω—è–µ—Ç: –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä
- –ö—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç: –í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏

**ORDERED, RECEIVED_FROM_SUPPLIER, COMPLETED** ‚Üí –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä
- ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –≠—Ç–∏ —Å—Ç–∞—Ç—É—Å—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –º–µ–Ω—è—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é
- –°—Ç–∞—Ç—É—Å—ã –¥–æ–ª–∂–Ω—ã –º–µ–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ SupplierOrder
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∏–∑ SupplierOrder, –∞ –Ω–µ –∏–∑ Invoice

### SupplierOrder (–ó–∞–∫–∞–∑ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É)

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
1. **ORDERED** ‚Üí –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞: "–ó–∞–∫–∞–∑ —Ä–∞–∑–º–µ—â–µ–Ω —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞"
2. **RECEIVED_FROM_SUPPLIER** ‚Üí –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞: "–¢–æ–≤–∞—Ä –ø–æ–ª—É—á–µ–Ω –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞"
3. **COMPLETED** ‚Üí –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞: "–ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º"

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞**:
- –í `app/api/supplier-orders/[id]/status/route.ts` —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- –ù–û —Å—Ç–∞—Ç—É—Å—ã Invoice —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `synchronizeDocumentStatuses`
- –ü–æ—ç—Ç–æ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ü–û–°–õ–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### Quote (–ö–ü)

**SENT** ‚Üí –ö–ª–∏–µ–Ω—Ç
- ‚ùå –ü–†–û–ë–õ–ï–ú–ê: `notifyUsersByRole('client')` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ö–ª–∏–µ–Ω—Ç—ã –ù–ï —è–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã
- –ù—É–∂–Ω–æ –ª–∏–±–æ:
  1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–µ—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å user_id)
  2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å email –∫–ª–∏–µ–Ω—Ç—É
  3. –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (—Ç.–∫. –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –∑–∞—Ö–æ–¥—è—Ç –≤ —Å–∏—Å—Ç–µ–º—É)

**ACCEPTED** ‚Üí –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ç–æ—Ä–∞, —á—Ç–æ –ö–ü –ø—Ä–∏–Ω—è—Ç–æ

---

## üõ†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ Quotes

**–í–∞—Ä–∏–∞–Ω—Ç –ê**: –£–±—Ä–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É (—Ç.–∫. –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –∑–∞—Ö–æ–¥—è—Ç –≤ —Å–∏—Å—Ç–µ–º—É)
```typescript
if (status === 'SENT') {
  // –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –∑–∞—Ö–æ–¥—è—Ç –≤ —Å–∏—Å—Ç–µ–º—É, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  console.log('üìß –ö–ü –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É:', quoteWithClient.number);
}
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë**: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ user_id –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
```typescript
if (status === 'SENT') {
  const client = await prisma.client.findUnique({
    where: { id: quoteWithClient.client_id },
    select: { user_id: true }
  });
  
  if (client && client.user_id) {
    await notifyUser(client.user_id, {
      clientId: quoteWithClient.client_id,
      documentId: id,
      type: 'quote_sent',
      title: '–ö–ü –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',
      message: `–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ${quoteWithClient.number} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.`
    });
  }
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î**:
- –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `EXECUTOR`?
- –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `COMPLECTATOR`?

**–ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω—É–∂–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏**:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è
- –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö

### 3. –£–¥–∞–ª–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É notifyUsersByRole –∏–∑ status-notifications.ts

**–§–∞–π–ª**: `lib/notifications/status-notifications.ts`

**–°—Ç—Ä–æ–∫–∏ 103-106**: –ó–∞–≥–ª—É—à–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
```typescript
async function notifyUsersByRole(role: string, message: string, documentId: string) {
  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–æ–ª–∏
  console.log(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ ${role}: ${message}`);
}
```

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, —Ç.–∫. –Ω–∞—Å—Ç–æ—è—â–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è —É–∂–µ –µ—Å—Ç—å –≤ `lib/notifications.ts`

---

## üìä –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. ‚úÖ –£–±—Ä–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ Quotes (—Ç.–∫. –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –∑–∞—Ö–æ–¥—è—Ç –≤ —Å–∏—Å—Ç–µ–º—É)
2. ‚úÖ –£–¥–∞–ª–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É `notifyUsersByRole` –∏–∑ `status-notifications.ts`
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ staging –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

