const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

async function updateTemplateWithCorrectHeaders() {
  try {
    console.log('üîß –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏...');
    
    const categoryId = 'cmg50xcgs001cv7mn0tdyk1wo';
    
    // –ó–∞–≥–æ–ª–æ–≤–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è–º —Å–≤–æ–π—Å—Ç–≤ –≤ –ë–î
    const correctHeaders = [
      'SKU',                    // –°–∏—Å—Ç–µ–º–Ω–æ–µ –ø–æ–ª–µ
      'Name',                   // –°–∏—Å—Ç–µ–º–Ω–æ–µ –ø–æ–ª–µ  
      'Price',                  // –°–∏—Å—Ç–µ–º–Ω–æ–µ –ø–æ–ª–µ
      'StockQuantity',          // –°–∏—Å—Ç–µ–º–Ω–æ–µ –ø–æ–ª–µ
      '–ê—Ä—Ç–∏–∫—É–ª –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞',     // –û—Å–Ω–æ–≤–Ω–æ–π –∞—Ä—Ç–∏–∫—É–ª
      'Domeo_–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è Web',  // –ú–æ–¥–µ–ª—å
      '–®–∏—Ä–∏–Ω–∞/–º–º',             // –†–∞–∑–º–µ—Ä
      '–í—ã—Å–æ—Ç–∞/–º–º',             // –†–∞–∑–º–µ—Ä
      '–¢–æ–ª—â–∏–Ω–∞/–º–º',            // –†–∞–∑–º–µ—Ä
      '–û–±—â–µ–µ_–¢–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è',     // –ü–æ–∫—Ä—ã—Ç–∏–µ
      'Domeo_–¶–≤–µ—Ç',            // –¶–≤–µ—Ç
      'Domeo_–°—Ç–∏–ª—å Web',       // –°—Ç–∏–ª—å
      '–¢–∏–ø –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏',       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–¢–∏–ø –æ—Ç–∫—Ä—ã–≤–∞–Ω–∏—è',         // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–ü–æ—Å—Ç–∞–≤—â–∏–∫',             // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–ï–¥.–∏–∑–º.',               // –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
      '–°–∫–ª–∞–¥/–∑–∞–∫–∞–∑',           // –ù–∞–ª–∏—á–∏–µ
      '–¶–µ–Ω–∞ –æ–ø—Ç',              // –¶–µ–Ω–∞
      '–ö—Ä–æ–º–∫–∞',                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞–¥–±–∞–≤–∫–∏ –∑–∞ –∫—Ä–æ–º–∫—É', // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–ú–æ–ª–¥–∏–Ω–≥',               // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–°—Ç–µ–∫–ª–æ',                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–§–∞–±—Ä–∏–∫–∞_–ö–æ–ª–ª–µ–∫—Ü–∏—è',     // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      '–§–∞–±—Ä–∏–∫–∞_–¶–≤–µ—Ç/–û—Ç–¥–µ–ª–∫–∞',  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
      'photos'                 // –§–æ—Ç–æ
    ];
    
    const requiredFields = ['SKU', 'Name', 'Price', '–ê—Ä—Ç–∏–∫—É–ª –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞', 'Domeo_–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è Web'];
    
    const templateConfig = {
      headers: correctHeaders,
      requiredFields: requiredFields,
      fieldMappings: {} // –£–±–∏—Ä–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ - –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
    };
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω
    const existingTemplate = await prisma.importTemplate.findUnique({
      where: { catalog_category_id: categoryId }
    });
    
    if (existingTemplate) {
      await prisma.importTemplate.update({
        where: { id: existingTemplate.id },
        data: {
          name: '–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –ú–µ–∂–∫–æ–º–Ω–∞—Ç–Ω—ã–µ –¥–≤–µ—Ä–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)',
          description: '–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º —Å–≤–æ–π—Å—Ç–≤ –≤ –ë–î',
          required_fields: JSON.stringify(requiredFields),
          calculator_fields: JSON.stringify(correctHeaders),
          export_fields: JSON.stringify(correctHeaders),
          template_config: JSON.stringify(templateConfig),
          field_mappings: JSON.stringify({}), // –û—á–∏—â–∞–µ–º –º–∞–ø–ø–∏–Ω–≥
          updated_at: new Date()
        }
      });
      console.log('‚úÖ –®–∞–±–ª–æ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω');
    } else {
      await prisma.importTemplate.create({
        data: {
          catalog_category_id: categoryId,
          name: '–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –ú–µ–∂–∫–æ–º–Ω–∞—Ç–Ω—ã–µ –¥–≤–µ—Ä–∏',
          description: '–®–∞–±–ª–æ–Ω —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º —Å–≤–æ–π—Å—Ç–≤ –≤ –ë–î',
          required_fields: JSON.stringify(requiredFields),
          calculator_fields: JSON.stringify(correctHeaders),
          export_fields: JSON.stringify(correctHeaders),
          template_config: JSON.stringify(templateConfig),
          field_mappings: JSON.stringify({})
        }
      });
      console.log('‚úÖ –®–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω');
    }
    
    console.log('\nüìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —à–∞–±–ª–æ–Ω–∞:');
    correctHeaders.forEach((header, index) => {
      const isRequired = requiredFields.includes(header);
      console.log(`  ${index + 1}. ${header}${isRequired ? ' (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)' : ''}`);
    });
    
    console.log('\nüéØ –î–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ SKU:');
    console.log('–§–æ—Ä–º–∞—Ç: [–ú–æ–¥–µ–ª—å]-[–†–∞–∑–º–µ—Ä]-[–ü–æ–∫—Ä—ã—Ç–∏–µ]-[–¶–≤–µ—Ç]-[–ù–æ–º–µ—Ä]');
    console.log('–ü—Ä–∏–º–µ—Ä: DomeoDoors_Base_1-600x2000-–ü–í–•-–ë–µ–ª—ã–π-001');
    console.log('\n–ü–æ–ª—è –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è SKU:');
    console.log('- –ú–æ–¥–µ–ª—å: Domeo_–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è Web');
    console.log('- –†–∞–∑–º–µ—Ä: –®–∏—Ä–∏–Ω–∞/–º–º x –í—ã—Å–æ—Ç–∞/–º–º');
    console.log('- –ü–æ–∫—Ä—ã—Ç–∏–µ: –û–±—â–µ–µ_–¢–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è');
    console.log('- –¶–≤–µ—Ç: Domeo_–¶–≤–µ—Ç');
    console.log('- –ù–æ–º–µ—Ä: –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ "–ù–æ–º–µ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞" –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ');
    
    console.log('\nüí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:');
    console.log('1. ‚úÖ –¢–µ–ø–µ—Ä—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ —à–∞–±–ª–æ–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞–∑–≤–∞–Ω–∏—è–º —Å–≤–æ–π—Å—Ç–≤ –≤ –ë–î');
    console.log('2. ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ —É–±—Ä–∞–Ω - –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å');
    console.log('3. ‚ö†Ô∏è –î–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ SKU –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ "–ù–æ–º–µ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞"');
    console.log('4. üìù –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π');
    
  } catch (error) {
    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
  } finally {
    await prisma.$disconnect();
  }
}

updateTemplateWithCorrectHeaders();
